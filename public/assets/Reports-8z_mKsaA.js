import{d as $e,p as Le,a9 as We,t as E,c as I,s as pe,aa as Qe,h as e,m as K,ad as Me,J as X,i as O,r as g,C as Oe,N as ae,Q as q,$ as qe,D as B,l as H,n as V,A as le,q as o,v as D,G as b,x as F,H as G,P as Z,F as ve}from"./index-BJXsJXEQ.js";import{u as oe}from"./EmailEditor.vue_vue_type_script_setup_true_lang-EdKtgQdf.js";import{V as ee}from"./VContainer-KtxZwDjL.js";import{V as te,a as M}from"./VRow-Bg1cyb2c.js";import{u as ze,m as je,a as Je,V as ke}from"./VSelect-CvB-Fqww.js";import{V as Ke}from"./VSpacer-BwG4EAcM.js";import{u as Xe,V as Q,o as Ye}from"./VGrid-Kwp1vHJk.js";import{e as ne}from"./VCard-Bki48CMZ.js";import{c as Ze,b as et,e as tt,u as at,k as lt,p as ot,s as nt,g as st,h as rt,i as it,j as ut,m as fe,n as ge,t as mt,q as dt,v as ct,V as Ve}from"./VDataTable-CjbvvPag.js";import{u as pt,m as vt}from"./filter-TDDVsa-L.js";import{V as ye}from"./VTable-DrCami9s.js";import{_ as he,C as ft,a as gt}from"./EmailControl.vue_vue_type_script_setup_true_lang-_JH0pyi-.js";import{V as yt}from"./forwardRefs-D5MLKHVf.js";import{V as xe}from"./VList-C7Fmy5_W.js";import{V as kt}from"./VSheet-K495EljI.js";import{a as Vt,b as Y,c as ht,V as xt}from"./VTabs-DQQFyNyT.js";import{V as Tt}from"./VToolbar-DfB8fpNi.js";import"./permission-Ba-8wP-4.js";import"./useConventionForms-BioktBEm.js";import"./sorted-PYsDa1V2.js";import"./VTextField-CBtAZoOg.js";import"./form-bAqzYwYJ.js";import"./VOverlay-DuUHWuCx.js";import"./scopeId-Dz51n7lc.js";import"./VChip-DOzEsuQ_.js";import"./createSimpleFunctional-eCbMUW7L.js";import"./VDivider-BEFg4Cuz.js";import"./ModelDialog.vue_vue_type_script_setup_true_lang-ttqoZ9fM.js";import"./SaveButton.vue_vue_type_script_setup_true_lang-BESi9yVk.js";import"./VDialog-Cqmlx84f.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./VAlert-Cp1HmrED.js";const bt=Le({...Me(dt(),["hideDefaultFooter"]),...mt(),...je(),...vt()},"VDataTableVirtual"),Rt=$e()({name:"VDataTableVirtual",props:bt(),emits:{"update:modelValue":l=>!0,"update:sortBy":l=>!0,"update:options":l=>!0,"update:groupBy":l=>!0,"update:expanded":l=>!0},setup(l,U){let{attrs:w,slots:a}=U;const{groupBy:T}=Ze(l),{sortBy:c,multiSort:p,mustSort:u}=et(l),{disableSort:h}=We(l),{columns:f,headers:C,filterFunctions:x,sortFunctions:v,sortRawFunctions:r}=tt(l,{groupBy:T,showSelect:E(()=>l.showSelect),showExpand:E(()=>l.showExpand)}),{items:n}=at(l,f),s=E(()=>l.search),{filteredItems:m}=pt(l,n,s,{transform:R=>R.columns,customKeyFilter:x}),{toggleSort:$}=lt({sortBy:c,multiSort:p,mustSort:u}),{sortByWithGroups:z,opened:d,extractRows:t,isGroupOpen:i,toggleGroup:k}=ot({groupBy:T,sortBy:c,disableSort:h}),{sortedItems:y}=nt(l,m,z,{transform:R=>({...R.raw,...R.columns}),sortFunctions:v,sortRawFunctions:r}),{flatItems:A}=st(y,T,d),N=I(()=>t(A.value)),{isSelected:L,select:W,selectAll:j,toggleSelect:Te,someSelected:be,allSelected:Re}=rt(l,{allItems:N,currentPage:N}),{isExpanded:De,toggleExpand:Ie}=it(l),{containerRef:Ue,markerRef:we,paddingTop:Ce,paddingBottom:Ne,computedItems:_e,handleItemResize:Se,handleScroll:Ae,handleScrollend:Ee,calculateVisibleItems:Be,scrollToIndex:Fe}=ze(l,A),Pe=I(()=>_e.value.map(R=>R.raw));ut({sortBy:c,page:pe(1),itemsPerPage:pe(-1),groupBy:T,search:s}),Qe({VDataTableRows:{hideNoData:E(()=>l.hideNoData),noDataText:E(()=>l.noDataText),loading:E(()=>l.loading),loadingText:E(()=>l.loadingText)}});const _=I(()=>({sortBy:c.value,toggleSort:$,someSelected:be.value,allSelected:Re.value,isSelected:L,select:W,selectAll:j,toggleSelect:Te,isExpanded:De,toggleExpand:Ie,isGroupOpen:i,toggleGroup:k,items:N.value.map(R=>R.raw),internalItems:N.value,groupedItems:A.value,columns:f.value,headers:C.value}));return Xe(()=>{const R=fe.filterProps(l),Ge=ge.filterProps(l),He=ye.filterProps(l);return e(ye,K({class:["v-data-table",{"v-data-table--loading":l.loading},l.class],style:l.style},He,{fixedHeader:l.fixedHeader||l.sticky}),{top:()=>{var S;return(S=a.top)==null?void 0:S.call(a,_.value)},wrapper:()=>{var S,se,re,ie,ue,me;return e("div",{ref:Ue,onScrollPassive:Ae,onScrollend:Ee,class:"v-table__wrapper",style:{height:X(l.height)}},[e("table",null,[(S=a.colgroup)==null?void 0:S.call(a,_.value),!l.hideDefaultHeader&&e("thead",{key:"thead"},[e(fe,R,a)]),(se=a.thead)==null?void 0:se.call(a,_.value),!l.hideDefaultBody&&e("tbody",{key:"tbody"},[e("tr",{ref:we,style:{height:X(Ce.value),border:0}},[e("td",{colspan:f.value.length,style:{height:0,border:0}},null)]),(re=a["body.prepend"])==null?void 0:re.call(a,_.value),e(ge,K(w,Ge,{items:Pe.value}),{...a,item:P=>e(Je,{key:P.internalItem.index,renderless:!0,"onUpdate:height":J=>Se(P.internalItem.index,J)},{default:J=>{var ce;let{itemRef:de}=J;return((ce=a.item)==null?void 0:ce.call(a,{...P,itemRef:de}))??e(ct,K(P.props,{ref:de,key:P.internalItem.index,index:P.internalItem.index}),a)}})}),(ie=a["body.append"])==null?void 0:ie.call(a,_.value),e("tr",{style:{height:X(Ne.value),border:0}},[e("td",{colspan:f.value.length,style:{height:0,border:0}},null)])]),(ue=a.tbody)==null?void 0:ue.call(a,_.value),(me=a.tfoot)==null?void 0:me.call(a,_.value)])])},bottom:()=>{var S;return(S=a.bottom)==null?void 0:S.call(a,_.value)}})}),{calculateVisibleItems:Be,scrollToIndex:Fe}}}),Dt={class:"my-4"},It={class:"d-flex ml-4"},Ut={class:"mx-4"},wt=O({__name:"HotelReport",emits:["pageTitle"],async setup(l,{emit:U}){let w,a;U("pageTitle","Reports");const c=ae(),p=q(),u=g([]),h=g(),f=g([]);try{const d=([w,a]=Oe(()=>oe()),w=await w,a(),w);d&&(c.getHotelReport(d.ConventionUUID).then(t=>{u.value=t}),c.getConventionVenues(d.ConventionUUID).then(t=>{f.value=t}))}catch{p.push("/")}const C=I(()=>[{title:"First Name",align:"start",key:"FirstName"},{title:"Last Name",align:"start",key:"LastName"},{title:"Address",align:"start",key:"Address"},{title:"Room Partners",align:"start",key:"Guests"},{title:"Venue",align:"start",key:"Venue"},{title:"Room Type",align:"start",key:"RoomType"},{title:"Arrival",align:"start",key:"ArrivalDay"},{title:"Departure",align:"start",key:"DepartureDay"}]),x=I(()=>{const d=[];return u.value.forEach(t=>{h.value&&t.Venue!=h.value||t.Guests.forEach((i,k)=>{const y={FirstName:"",LastName:"",Guests:"",Address:"",Venue:"",Accommodation:"",RoomType:"",ArrivalDay:"",DepartureDay:""};y.FirstName=i.FirstName,y.LastName=i.LastName,y.Address=i.Address;const A=t.Guests.filter((W,j)=>j!==k);let N="";A.forEach(W=>{N+=W.FirstName+" "+W.LastName+","}),y.Guests=N.substring(0,N.length-1),y.Venue=t.Venue;const L=t.Accommodation.match(/\((.*?)\)/);L&&L.length>=1&&(y.Accommodation=L[1]),y.RoomType=t.RoomType,y.ArrivalDay=t.Days[0],y.DepartureDay=t.Days[t.Days.length-1],d.push(y)})}),d}),v=I(()=>{const d=new Map;return u.value.forEach(t=>{let i;const k=`${t.Days[0]} - ${t.Days[t.Days.length-1]}`;d.has(k)?i=d.get(k):i=new Map,i.has(t.Accommodation)?i.set(t.Accommodation,i.get(t.Accommodation)+1):i.set(t.Accommodation,1),d.set(k,i)}),d.forEach((t,i)=>{d.set(i,new Map([...t.entries()].sort()))}),d}),r=qe("reportTable"),n="data:application/vnd.ms-excel;base64,",s='<html xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:x="urn:schemas-microsoft-com:office:excel" xmlns="http://www.w3.org/TR/REC-html40"><head><!--[if gte mso 9]><?xml version="1.0" encoding="UTF-8" standalone="yes"?><x:ExcelWorkbook><x:ExcelWorksheets><x:ExcelWorksheet><x:Name>{worksheet}</x:Name><x:WorksheetOptions><x:DisplayGridlines/></x:WorksheetOptions></x:ExcelWorksheet></x:ExcelWorksheets></x:ExcelWorkbook></xml><![endif]--><meta http-equiv="content-type" content="text/plain; charset=UTF-8"/></head><body><table>{table}</table></body></html>',m=function(d){return btoa(unescape(encodeURIComponent(d)))},$=function(d,t){return d.replace(/{(\w+)}/g,function(i,k){return t[k]})},z=d=>{var i;const t=(i=r.value)==null?void 0:i.getElementsByTagName("table")[0];if(t){const k={worksheet:d,table:t.innerHTML};window.location.href=n+m($(s,k))}};return(d,t)=>u.value.length>0&&f.value.length>0?(V(),B(G,{key:0},[e(ee,{fluid:""},{default:o(()=>[e(te,null,{default:o(()=>[e(M,{cols:"12",sm:"6",md:"4",lg:"3",xl:"2"},{default:o(()=>[e(ke,{modelValue:h.value,"onUpdate:modelValue":t[0]||(t[0]=i=>h.value=i),label:"Venue",items:f.value,"item-value":"Name","item-title":"Name",clearable:"",variant:"outlined","hide-details":""},null,8,["modelValue","items"])]),_:1}),e(Ke),e(M,{cols:"12",sm:"5",md:"3",lg:"2",xl:"2",class:"text-right"},{default:o(()=>[e(Q,{onClick:t[1]||(t[1]=i=>z("Hotel Report")),color:"primary","prepend-icon":"mdi:mdi-table",class:"w-100 w-sm-auto"},{default:o(()=>t[2]||(t[2]=[D(" Download Excel ")])),_:1})]),_:1})]),_:1})]),_:1}),x.value?(V(),H(ne,{key:0,class:"pa-2"},{default:o(()=>[b("div",{ref_key:"reportTable",ref:r},[e(Rt,{headers:C.value,items:x.value,"items-length":x.value.length},{"item.RoomType":o(({item:i})=>[D(F(i.RoomType)+" ",1),t[3]||(t[3]=b("br",null,null,-1)),D(" ("+F(i.Accommodation)+") ",1)]),_:2},1032,["headers","items","items-length"]),t[4]||(t[4]=b("h2",{class:"my-4"},"Room Count Summary",-1)),b("dl",null,[(V(!0),B(G,null,Z(v.value.entries(),([i,k])=>(V(),B(G,null,[b("dt",Dt,[b("strong",null,F(i),1)]),(V(!0),B(G,null,Z(k.entries(),([y,A])=>(V(),B("dd",null,[b("dl",It,[b("dt",Ut,F(y),1),b("dd",null,F(A),1)])]))),256))],64))),256))])],512)]),_:1})):le("",!0)],64)):(V(),H(ee,{key:1},{default:o(()=>[e(te,null,{default:o(()=>[e(M,{class:"text-center"},{default:o(()=>[e(Ye,{indeterminate:"",color:"primary",size:"100",width:"10"},{default:o(()=>t[5]||(t[5]=[D(" Loading ")])),_:1})]),_:1})]),_:1})]),_:1}))}}),Ct={class:"flex-grow-1"},Nt=O({__name:"TicketReport",emits:["pageTitle"],setup(l,{emit:U}){U("pageTitle","Reports");const a=ae(),T=q(),c=g(),p=g([]),u=g([]),h=g(!0),f=()=>{try{oe().then(v=>{v&&(c.value=v,a.getTicketReport(c.value.ConventionUUID).then(r=>{p.value=r,h.value=!1}))})}catch{T.push("/")}},C=I(()=>[{title:"Reference",align:"start",key:"Reference"},{title:"Name",align:"start",key:"Name"},{title:"Ticket",align:"start",key:"Ticket"},{title:"QR Code",align:"start",key:"QRCode"}]),x=I(()=>p.value?p.value.map(v=>({RegistrationUUID:v.RegistrationUUID,Reference:v.Reference,Name:v.Name,Ticket:v.Ticket.map(n=>n.Name),QRCode:v.QRCode})):[]);return f(),(v,r)=>c.value&&p.value?(V(),H(ne,{key:0,class:"pa-2"},{default:o(()=>[e(Ve,{modelValue:u.value,"onUpdate:modelValue":r[2]||(r[2]=n=>u.value=n),headers:C.value,items:x.value,"item-value":"RegistrationUUID","show-select":"",loading:h.value},{"item.Ticket":o(({item:n})=>[e(xe,{items:n.Ticket},null,8,["items"])]),"item.QRCode":o(({item:n})=>[e(yt,{src:n.QRCode,alt:n.Reference},null,8,["src","alt"])]),"footer.prepend":o(()=>[b("div",Ct,[e(Q,{variant:"text",color:"primary",onClick:r[0]||(r[0]=n=>u.value=x.value.map(s=>s.RegistrationUUID))},{default:o(()=>r[6]||(r[6]=[D(" (Select all on every page) ")])),_:1}),e(Q,{variant:"text",color:"primary",onClick:r[1]||(r[1]=n=>u.value=[])},{default:o(()=>r[7]||(r[7]=[D(" (Unselect all on every page) ")])),_:1})])]),_:2},1032,["modelValue","headers","items","loading"]),e(he,{modelValue:u.value,"onUpdate:modelValue":r[3]||(r[3]=n=>u.value=n),details:x.value,"onUpdate:details":r[4]||(r[4]=n=>x.value=n),"model-type":"registration",convention:c.value,"onUpdate:convention":r[5]||(r[5]=n=>c.value=n)},null,8,["modelValue","details","convention"])]),_:1})):le("",!0)}}),_t={class:"flex-grow-1"},St=O({__name:"CheckInReport",emits:["pageTitle"],setup(l,{emit:U}){U("pageTitle","Reports");const a=ae(),T=q(),c=g(),p=g([]),u=g([]),h=g(!0),f=g(),C=g([{key:"Reference",order:"asc"}]),x=()=>{try{oe().then(n=>{var s;n&&(c.value=n,a.getCheckInReport((s=c.value)==null?void 0:s.ConventionUUID).then(m=>{p.value=m,h.value=!1}))})}catch{T.push("/")}},v=I(()=>[{title:"Reference",align:"start",key:"Reference"},{title:"Name",align:"start",key:"Name"},{title:"Ticket",align:"start",key:"Ticket"},{title:"Checked In",align:"start",key:"CheckedIn"}]),r=I(()=>p.value?p.value.filter(n=>f.value?n.CheckedIn===f.value:!0).map(n=>({RegistrationUUID:n.RegistrationUUID,Reference:n.Reference,Name:n.Name,Ticket:n.Ticket.map(m=>m.Name),CheckedIn:n.CheckedIn})):[]);return x(),(n,s)=>(V(),B(G,null,[e(ee,{fluid:""},{default:o(()=>[e(te,null,{default:o(()=>[e(M,{cols:"12",sm:"6",md:"4",lg:"3",xl:"2"},{default:o(()=>[e(ke,{modelValue:f.value,"onUpdate:modelValue":s[0]||(s[0]=m=>f.value=m),label:"Status",items:ve(ft),"item-value":"value","item-title":"title",clearable:"",variant:"outlined","hide-details":""},null,8,["modelValue","items"])]),_:1})]),_:1})]),_:1}),c.value&&p.value?(V(),H(ne,{key:0,class:"pa-2"},{default:o(()=>[e(Ve,{modelValue:u.value,"onUpdate:modelValue":s[3]||(s[3]=m=>u.value=m),headers:v.value,items:r.value,"item-value":"RegistrationUUID","show-select":"",loading:h.value,"sort-by":C.value,"onUpdate:sortBy":s[4]||(s[4]=m=>C.value=m)},{"item.CheckedIn":o(({item:m})=>[D(F(ve(gt)(m.CheckedIn)),1)]),"item.Ticket":o(({item:m})=>[e(xe,{items:m.Ticket},null,8,["items"])]),"footer.prepend":o(()=>[b("div",_t,[e(Q,{variant:"text",color:"primary",onClick:s[1]||(s[1]=m=>u.value=r.value.map($=>$.RegistrationUUID))},{default:o(()=>s[8]||(s[8]=[D(" (Select all on every page) ")])),_:1}),e(Q,{variant:"text",color:"primary",onClick:s[2]||(s[2]=m=>u.value=[])},{default:o(()=>s[9]||(s[9]=[D(" (Unselect all on every page) ")])),_:1})])]),_:2},1032,["modelValue","headers","items","loading","sort-by"]),e(he,{modelValue:u.value,"onUpdate:modelValue":s[5]||(s[5]=m=>u.value=m),details:r.value,"onUpdate:details":s[6]||(s[6]=m=>r.value=m),"model-type":"registration",convention:c.value,"onUpdate:convention":s[7]||(s[7]=m=>c.value=m)},null,8,["modelValue","details","convention"])]),_:1})):le("",!0)],64))}}),da=O({__name:"Reports",emits:["pageTitle"],setup(l,{emit:U}){U("pageTitle","Reports"),q();const a=g("Hotel"),T=g(["Hotel","Tickets","Check In"]);return(c,p)=>(V(),H(kt,null,{default:o(()=>[e(Tt,{color:"blue-darken-4"},{default:o(()=>[e(Vt,{modelValue:a.value,"onUpdate:modelValue":p[0]||(p[0]=u=>a.value=u),"show-arrows":""},{default:o(()=>[(V(!0),B(G,null,Z(T.value,u=>(V(),H(xt,null,{default:o(()=>[D(F(u),1)]),_:2},1024))),256))]),_:1},8,["modelValue"])]),_:1}),e(ht,{modelValue:a.value,"onUpdate:modelValue":p[1]||(p[1]=u=>a.value=u)},{default:o(()=>[e(Y,{value:"Hotel"},{default:o(()=>[e(wt)]),_:1}),e(Y,{value:"Tickets"},{default:o(()=>[e(Nt)]),_:1}),e(Y,{value:"Check In"},{default:o(()=>[e(St)]),_:1})]),_:1},8,["modelValue"])]),_:1}))}});export{da as default};
