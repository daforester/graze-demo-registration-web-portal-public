import{_ as le,T as B,u as ae}from"./EmailEditor.vue_vue_type_script_setup_true_lang-D174le79.js";import{u as te}from"./useConventionSlug-TQftUy_5.js";import{i as W,N as w,D as A,n as p,M as oe,r as i,C as se,w as ue,A as U,h as a,H as J,l as g,q as t,G as I,v as n,F as ie,O as ne,U as de,k as re}from"./index-SDpjOfEK.js";import{_ as me}from"./ModelDialog.vue_vue_type_script_setup_true_lang-CKqjlfMv.js";import{_ as ve}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{b as Y}from"./forwardRefs-DfTulyk4.js";import{V as H,a as d}from"./VRow-DPWtpV-z.js";import{V as fe}from"./VSelect-CRl7qyu_.js";import{V as f,o as pe}from"./VGrid-BGPmBRnj.js";import{V as Te,a as Ve}from"./VAlert-Q2g8-bvw.js";import{V as z}from"./VList-QopZ7B7L.js";import{V as Ee}from"./VOverlay-CZc4vxJ-.js";import{e as Ue,V as Ce,a as ce,c as ge}from"./VCard-DOrAlY6L.js";import{V as Ie}from"./VSpacer-BubqRHeT.js";import{V as O}from"./VTextField-BBDZZhSJ.js";import{V as we}from"./SaveButton.vue_vue_type_script_setup_true_lang-BphHTEIC.js";var Ne=(u=>(u.CHECK_IN_STATUS_PENDING="CHECK_IN_STATUS_PENDING",u.CHECK_IN_STATUS_COMPLETED="CHECK_IN_STATUS_COMPLETED",u.CHECK_IN_STATUS_REJECTED="CHECK_IN_STATUS_REJECTED",u.CHECK_IN_STATUS_REVOKED="CHECK_IN_STATUS_REVOKED",u))(Ne||{});const Se=[{title:"Pending",value:"CHECK_IN_STATUS_PENDING"},{title:"Completed",value:"CHECK_IN_STATUS_COMPLETED"},{title:"Rejected",value:"CHECK_IN_STATUS_REJECTED"},{title:"Revoked",value:"CHECK_IN_STATUS_REVOKED"}],Je=u=>{var r;return((r=Se.find(c=>c.value===u))==null?void 0:r.title)||""},be=["innerHTML"],De=W({__name:"EmailPreviewWindow",props:{modelValue:{required:!0},modelModifiers:{}},emits:["update:modelValue"],setup(u){const r=w(u,"modelValue");return(c,M)=>(p(),A("div",{innerHTML:r.value,class:"reset-styles"},null,8,be))}}),_e=ve(De,[["__scopeId","data-v-a08129c7"]]),ye={class:"d-flex align-center justify-center",style:{width:"calc(100vw - 25px)",height:"100vh"}},Ye=W({__name:"EmailControl",props:oe({modelType:{default:"user"},custom:{type:Boolean,default:!1}},{modelValue:{default:[]},modelModifiers:{},details:{required:!1},detailsModifiers:{},convention:{required:!1,default:void 0},conventionModifiers:{},organisation:{required:!1,default:void 0},organisationModifiers:{}}),emits:["update:modelValue","update:details","update:convention","update:organisation"],async setup(u){let r,c;const M=ne(),{getEmailTemplateList:Q}=ae(),{getConvention:X}=te(),F=i([]),o=i(),N=w(u,"modelValue"),x=w(u,"details"),T=w(u,"convention");T.value||(T.value=([r,c]=se(()=>X()),r=await r,c(),r));const R=w(u,"organisation"),V=i(0),E=i([]),K=i(!1),S=i(!1),L=i(0),b=i(0),m=i([]),C=i(!1),D=i(""),_=i(""),y=i(""),k=i(""),P=i(!1),$=()=>{var s,e;Q(B.TARGET_TYPE_CONVENTION,((s=R.value)==null?void 0:s.OrganisationUUID)||null,((e=T.value)==null?void 0:e.ConventionUUID)||null).then(l=>{F.value=l})};ue(T,()=>{$()}),$();const j=(s,e=!1)=>{var v;const l={};return u.modelType=="registration"?l.RegistrationUUID=s:u.modelType=="submission"?l.SubmissionUUID=s:l.UserUUID=s,T.value&&(l.ConventionUUID=T.value.ConventionUUID),R.value&&(l.OrganisationUUID=R.value.OrganisationUUID),o.value&&(o.value.IsDefault?l.TemplateName=o.value.Name:((v=o.value)==null?void 0:v.EmailTemplateUUID)!==de?l.TemplateUUID=o.value.EmailTemplateUUID:l.Template=o.value),e&&(l.Template=re(o.value),l.TemplateUUID=void 0,l.TemplateName=void 0,l.Template&&(l.Template.HTML=y.value,l.Template.Subject=k.value,l.Template.From=D.value,l.Template.FromName=_.value)),l},G=()=>{E.value=[],N.value.forEach(s=>{const e=j(s,C.value);M.previewEmailTemplate(e).then(l=>{E.value.push(l)})}),V.value=0,K.value=!0};function Z(s){return new Promise(e=>setTimeout(e,s))}const q=async()=>{S.value=!0,L.value=0,b.value=0,m.value=[];for(const s of N.value){const e=j(s,C.value);try{await M.sendEmailTemplate(e)}catch{if(e.RegistrationUUID&&x.value&&x.value.length>0){const v=x.value.find(ee=>ee.RegistrationUUID==e.RegistrationUUID);v?m.value.push(`Failed to send to: #${v.Reference} - ${v.Name}`):m.value.push(`Failed to send to: UUID ${e.RegistrationUUID}`)}else m.value.push(`Failed to send to: UUID ${e.RegistrationUUID}`)}await Z(50),L.value+=1,b.value=L.value/N.value.length*100}S.value=!1,m.value.length===0&&(P.value=!0)},h=async()=>{var s,e,l,v;y.value=((s=o.value)==null?void 0:s.HTML)||"",D.value=((e=o.value)==null?void 0:e.From)||"",_.value=((l=o.value)==null?void 0:l.FromName)||"",k.value=((v=o.value)==null?void 0:v.Subject)||"",C.value=!0};return(s,e)=>(p(),A("div",null,[N.value.length>0?(p(),A(J,{key:0},[a(H,null,{default:t(()=>[a(d,null,{default:t(()=>e[15]||(e[15]=[I("h2",null,"E-Mail",-1),I("p",null," Select an e-mail template to send bulk e-mails to selected registrations. You may preview what is sent before queuing it. ",-1)])),_:1})]),_:1}),C.value?U("",!0):(p(),g(H,{key:0},{default:t(()=>[a(d,{cols:"12",md:"6"},{default:t(()=>[a(fe,{modelValue:o.value,"onUpdate:modelValue":e[0]||(e[0]=l=>o.value=l),items:F.value,"item-value":l=>l,"item-title":"Title","hide-details":"",clearable:""},null,8,["modelValue","items","item-value"])]),_:1}),s.custom?(p(),g(d,{key:0,cols:"4",md:"2"},{default:t(()=>[a(f,{color:"warning",disabled:!o.value,onClick:h,class:"w-100"},{default:t(()=>e[16]||(e[16]=[n(" Customise ")])),_:1},8,["disabled"])]),_:1})):U("",!0),a(d,{cols:"4",md:"2"},{default:t(()=>[a(f,{color:"primary",disabled:!o.value,onClick:G,class:"w-100"},{default:t(()=>e[17]||(e[17]=[n(" Preview ")])),_:1},8,["disabled"])]),_:1}),a(d,{cols:"4",md:"2",class:"text-right text-sm-left"},{default:t(()=>[a(f,{color:"success",disabled:!o.value,onClick:q,class:"w-100"},{default:t(()=>e[18]||(e[18]=[n(" Send ")])),_:1},8,["disabled"])]),_:1})]),_:1})),m.value.length?(p(),g(Te,{key:1,color:"error",class:"mt-4"},{default:t(()=>[a(Ve,null,{default:t(()=>e[19]||(e[19]=[n("Errors Encountered")])),_:1}),a(z,{items:m.value,class:"mt-4 rounded"},null,8,["items"])]),_:1})):U("",!0),a(Ee,{modelValue:S.value,"onUpdate:modelValue":e[2]||(e[2]=l=>S.value=l),"scroll-strategy":"block","location-strategy":"static","close-on-content-click":!1},{default:t(()=>[I("div",ye,[e[22]||(e[22]=n(" > ")),a(Ue,{class:"ma-0",bordered:""},{default:t(()=>[a(Ce,null,{default:t(()=>[a(ce,{class:"text-center"},{default:t(()=>e[20]||(e[20]=[I("small",null,"Sending Emails",-1)])),_:1})]),_:1}),a(ge,{class:"text-center"},{default:t(()=>[a(pe,{modelValue:b.value,"onUpdate:modelValue":e[1]||(e[1]=l=>b.value=l),color:"error",size:"60",width:"8"},null,8,["modelValue"]),e[21]||(e[21]=I("p",{class:"my-4"}," Navigating away will prevent emails from sending. ",-1)),m.value.length?(p(),g(z,{key:0,items:m.value},null,8,["items"])):U("",!0)]),_:1})]),_:1})])]),_:1},8,["modelValue"]),a(me,{modelValue:K.value,"onUpdate:modelValue":e[6]||(e[6]=l=>K.value=l),fullscreen:!1,"hide-details":!0,title:"Email Preview",scrollable:!0},{actions:t(()=>[a(Y,null,{default:t(()=>[a(f,{color:"primary",disabled:V.value==0,onClick:e[3]||(e[3]=l=>V.value-=1)},{default:t(()=>e[23]||(e[23]=[n(" Previous ")])),_:1},8,["disabled"])]),_:1}),a(Ie),a(Y,null,{default:t(()=>[a(f,{color:"primary",disabled:V.value==E.value.length-1,onClick:e[4]||(e[4]=l=>V.value+=1)},{default:t(()=>e[24]||(e[24]=[n(" Next ")])),_:1},8,["disabled"])]),_:1})]),default:t(()=>[E.value.length>0&&E.value[V.value]?(p(),g(_e,{key:0,modelValue:E.value[V.value].HTML,"onUpdate:modelValue":e[5]||(e[5]=l=>E.value[V.value].HTML=l)},null,8,["modelValue"])):U("",!0)]),_:1},8,["modelValue"])],64)):U("",!0),C.value?(p(),A(J,{key:1},[a(H,null,{default:t(()=>[a(d,{cols:"12",lg:"4"},{default:t(()=>[a(O,{modelValue:k.value,"onUpdate:modelValue":e[7]||(e[7]=l=>k.value=l),label:"Custom Subject",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1}),a(d,{cols:"12",md:"6",lg:"4"},{default:t(()=>[a(O,{modelValue:_.value,"onUpdate:modelValue":e[8]||(e[8]=l=>_.value=l),label:"Custom From Name",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1}),a(d,{cols:"12",md:"6",lg:"4"},{default:t(()=>[a(O,{modelValue:D.value,"onUpdate:modelValue":e[9]||(e[9]=l=>D.value=l),label:"Custom From Email",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1})]),_:1}),a(le,{modelValue:y.value,"onUpdate:modelValue":e[10]||(e[10]=l=>y.value=l),convention:T.value,"onUpdate:convention":e[11]||(e[11]=l=>T.value=l),"owner-type":ie(B).TARGET_TYPE_CONVENTION},null,8,["modelValue","convention","owner-type"]),a(H,{class:"justify-end"},{default:t(()=>[a(d,{cols:"4",sm:"2"},{default:t(()=>[a(f,{color:"warning",disabled:!o.value,onClick:e[12]||(e[12]=l=>C.value=!1),class:"w-100"},{default:t(()=>e[25]||(e[25]=[n(" Cancel ")])),_:1},8,["disabled"])]),_:1}),a(d,{cols:"4",sm:"2"},{default:t(()=>[a(f,{color:"primary",disabled:!o.value,onClick:G,class:"w-100"},{default:t(()=>e[26]||(e[26]=[n(" Preview ")])),_:1},8,["disabled"])]),_:1}),a(d,{cols:"4",sm:"2",class:"text-right text-sm-left"},{default:t(()=>[a(f,{color:"success",disabled:!o.value,onClick:q,class:"w-100"},{default:t(()=>e[27]||(e[27]=[n(" Send ")])),_:1},8,["disabled"])]),_:1})]),_:1})],64)):U("",!0),a(we,{modelValue:P.value,"onUpdate:modelValue":e[14]||(e[14]=l=>P.value=l)},{actions:t(()=>[a(f,{variant:"text",onClick:e[13]||(e[13]=l=>P.value=!1)},{default:t(()=>e[28]||(e[28]=[n(" Close ")])),_:1})]),default:t(()=>[e[29]||(e[29]=n(" E-mail Sent "))]),_:1},8,["modelValue"])]))}});export{Se as C,Ye as _,Je as a,Ne as b};
