import{i as N,M as E,N as P,r as v,k as J,$ as R,l as w,n as C,q as a,h as e,A as T,v as V,x as S,F as p,O as X,L as ee,z as ae,V as te,D as M,Q as le,H as F}from"./index-DJ0RbLYI.js";import{s as O}from"./index-zHJ-1AxG.js";import{u as A}from"./useStoreAPI-BAva0LWL.js";import{_ as oe}from"./DeleteDialog.vue_vue_type_script_setup_true_lang-DFasgKuQ.js";import{V as G}from"./VForm-BA1rLFgX.js";import{e as h,c as ne,a as ie,b as se,V as re,d as ue}from"./VCard-DOt-UZwl.js";import{V as me,a as de}from"./VToolbar-BcHjpW9W.js";import{V as fe}from"./VSpacer-Bdw4fPKS.js";import{V as ge}from"./VToolbarItems-D8Ix0Q2u.js";import{V as x,d as pe}from"./VGrid-BFfj_YI8.js";import{V as B}from"./VContainer-Ct1yHzJ3.js";import{V as g,a as f}from"./VRow-BCToQxne.js";import{V as q}from"./forwardRefs-DVryrUdK.js";import{V as y}from"./VTextField-BL6i6uVw.js";import{V as ve}from"./VFileInput-CoCq4ljc.js";import{V as $}from"./VTextarea-Dyfd1LzI.js";import{_ as z}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{G as H}from"./userData-DvHktJL_.js";import{V as Ve}from"./VDialog-Bi0c0z4K.js";import{C as ce}from"./canEditOrganisation-ZuT7y_Ih.js";import{C as _e,G as Ce}from"./canDo-Dnc6Xhwh.js";import{u as Ie}from"./useTitleSetter-CPFRtLz3.js";import{v as Oe}from"./v4-CtRu48qb.js";import"./SaveButton.vue_vue_type_script_setup_true_lang-huTGH6uG.js";import"./VOverlay-Dg3CmZYv.js";import"./scopeId-caWRonYC.js";import"./form-DcIm94kF.js";import"./createSimpleFunctional-yVllG_0I.js";import"./VChip-D-vfdAXu.js";const De=(I,c)=>{if(I===void 0)return!1;const l=_e(I,Ce.GROUP_TYPE_ORGANISATION,c.OrganisationUUID);return l.EditOrganisation||l.EditConvention||l.ManageViews||l.ViewRegistration||l.EditRegistration||l.ManageUsers},be=N({__name:"EditOrganisation",props:{modelValue:{required:!0},modelModifiers:{}},emits:E(["change","close","delete"],["update:modelValue"]),setup(I,{emit:c}){const l=c,u=X(),D=A(),b=P(I,"modelValue"),o=v(J(b.value)),d=v(`${D.GetOrganisationLogoURL(o.value.OrganisationUUID)}?${new Date().getTime()}`),m=R("imageFileInput"),r=R("organisationImageForm"),n=v(!1),U=v(""),_=R("form"),Y=async()=>{var t;const i=new FormData((t=r.value)==null?void 0:t.$el);if(i.get("Image")&&i.get("Image").size>0)return i.set("OrganisationUUID",o.value.OrganisationUUID),await D.SaveOrganisationLogo(i)},j=()=>{var i;Y(),(i=_.value)==null||i.validate().then(t=>{t&&u.saveOrganisation(o.value).then(s=>{s&&(b.value=s,l("change"),l("close"))})})},L=v({available:i=>!0,min:i=>i.length>=4||"Minimum 4 characters",required:i=>!!i||"Required.",valid:i=>!/[^0-9a-z_-]/.test(i)||"Only lower-case letters, numbers, hyphens and underscores permitted"}),k=()=>{n.value=!1},K=()=>{n.value=!0},Q=v(`
<p class="mb-2">
  Are you sure you wish to delete this organisation? All data relating to it will be
  removed including all conventions their respective registrations and payment information.
  This action can not be undone.
</p>
<p class="mb-2">
  We are talking some Thanos level shit right here, if you proceed a team of super-powered
  beings with Daddy issues will hunt you down through time, space and a social media
  platform formerly known as twitter.
</p>
<p>
  To confirm type "I CLICK MY FINGERS" in the box below.
</p>
`),W=i=>{U.value="",u.deleteOrganisation(o.value.OrganisationUUID).then(t=>{t?i&&i("Organisation Deleted"):i&&i("Failed to Delete Organisation"),setTimeout(()=>{k(),l("delete")},2e3)}).catch(()=>{i&&(i("Failed to Delete Organisation"),setTimeout(k,2e3))})},Z=()=>{try{m.value&&m.value.files&&m.value.files[0]&&(d.value=URL.createObjectURL(m.value.files[0]))}catch{}};return(i,t)=>(C(),w(G,{"fast-fail":"",ref:"form"},{default:a(()=>[e(h,null,{default:a(()=>[e(me,{dark:"",color:"primary"},{default:a(()=>[e(de,null,{default:a(()=>[V(S(o.value.Name),1)]),_:1}),e(fe),e(ge,null,{default:a(()=>[e(x,{variant:"text",onClick:K},{default:a(()=>t[8]||(t[8]=[V(" Delete ")])),_:1}),e(x,{variant:"text",onClick:j},{default:a(()=>t[9]||(t[9]=[V(" Save ")])),_:1}),e(x,{icon:"",dark:"",onClick:t[0]||(t[0]=s=>l("close"))},{default:a(()=>[e(pe,null,{default:a(()=>t[10]||(t[10]=[V("mdi:mdi-close")])),_:1})]),_:1})]),_:1})]),_:1}),e(ne,null,{default:a(()=>[e(B,{fluid:!0},{default:a(()=>[e(g,null,{default:a(()=>[e(f,{cols:"12"},{default:a(()=>[e(q,{class:"imgLogo mx-auto",src:d.value||""},null,8,["src"])]),_:1})]),_:1}),e(g,null,{default:a(()=>[e(f,{cols:"12"},{default:a(()=>[e(y,{label:p(O).formLabelName,type:"text",variant:"outlined",modelValue:o.value.Name,"onUpdate:modelValue":t[1]||(t[1]=s=>o.value.Name=s)},null,8,["label","modelValue"])]),_:1})]),_:1}),e(g,null,{default:a(()=>[e(f,{cols:"12"},{default:a(()=>[e(y,{label:p(O).formLabelSlug,pattern:"[a-zA-Z0-9_\\-]{6,25}",rules:[L.value.available,L.value.min,L.value.required,L.value.valid],type:"text",variant:"outlined",modelValue:o.value.Slug,"onUpdate:modelValue":t[2]||(t[2]=s=>o.value.Slug=s)},null,8,["label","rules","modelValue"])]),_:1})]),_:1}),e(g,null,{default:a(()=>[e(f,{cols:"12"},{default:a(()=>[e(y,{label:p(O).formLabelDomain,type:"text",variant:"outlined",modelValue:o.value.Domain,"onUpdate:modelValue":t[3]||(t[3]=s=>o.value.Domain=s)},null,8,["label","modelValue"])]),_:1})]),_:1}),e(g,null,{default:a(()=>[e(f,null,{default:a(()=>[e(G,{ref:"organisationImageForm",enctype:"multipart/form-data"},{default:a(()=>[e(ve,{label:p(O).formLabelLogo,name:"Image",variant:"outlined",ref:"imageFileInput",accept:"image/avif, image/bmp, image/gif, image/jpeg, image/png, image/webp","hide-details":"",onChange:Z},null,8,["label"])]),_:1})]),_:1})]),_:1}),e(g,null,{default:a(()=>[e(f,{cols:"12"},{default:a(()=>[e(y,{label:p(O).formLabelRegTitle,type:"text",variant:"outlined",modelValue:o.value.RegTitle,"onUpdate:modelValue":t[4]||(t[4]=s=>o.value.RegTitle=s)},null,8,["label","modelValue"])]),_:1})]),_:1}),e(g,null,{default:a(()=>[e(f,{cols:"12"},{default:a(()=>[e($,{label:p(O).formLabelCSS,type:"text",variant:"outlined",modelValue:o.value.CSS,"onUpdate:modelValue":t[5]||(t[5]=s=>o.value.CSS=s)},null,8,["label","modelValue"])]),_:1})]),_:1}),e(g,null,{default:a(()=>[e(f,{cols:"12"},{default:a(()=>[e($,{label:p(O).formLabelHTML,type:"text",variant:"outlined",modelValue:o.value.HTML,"onUpdate:modelValue":t[6]||(t[6]=s=>o.value.HTML=s)},null,8,["label","modelValue"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),n.value?(C(),w(oe,{key:0,modelValue:n.value,"onUpdate:modelValue":t[7]||(t[7]=s=>n.value=s),title:`Delete ${o.value.Name}`,subtitle:"Your will be done",message:Q.value,"confirmation-text":"I CLICK MY FINGERS",onDelete:W},null,8,["modelValue","title","message"])):T("",!0)]),_:1}))}}),Ue=z(be,[["__scopeId","data-v-473fdcf8"]]),we=N({__name:"OrganisationCard",props:{modelValue:{required:!0},modelModifiers:{}},emits:E(["delete"],["update:modelValue"]),setup(I,{emit:c}){const l=H();(!l||!l.Groups.find(r=>r.Permission.EditConvention)&&!l.Groups.find(r=>r.Permission.EditOrganisation)&&!l.Groups.find(r=>r.Permission.EditRegistration)&&!l.Groups.find(r=>r.Permission.ManageViews)&&!l.Groups.find(r=>r.Permission.ViewRegistration))&&ee().push("/");const u=P(I,"modelValue"),D=c,b=A(),o=v(!1),d=v(""),m=()=>{d.value=`${b.GetOrganisationLogoURL(u.value.OrganisationUUID)}?${new Date().getTime()}`};return m(),(r,n)=>{const U=ae("RouterLink");return C(),w(h,null,{default:a(()=>[e(re,{class:"flex-1-1 align-content-start"},{default:a(()=>[e(q,{class:"imgLogo mx-auto",src:d.value||""},null,8,["src"]),e(ie,null,{default:a(()=>[V(S(u.value.Name),1)]),_:1}),e(se,null,{default:a(()=>[V(S(u.value.Slug),1)]),_:1})]),_:1}),e(ue,null,{default:a(()=>[e(g,{"no-gutters":""},{default:a(()=>[e(f,{class:"ma-1"},{default:a(()=>[e(x,{variant:"tonal",color:"primary",onClick:n[0]||(n[0]=_=>o.value=!0),width:"100%"},{default:a(()=>n[5]||(n[5]=[V("Edit")])),_:1})]),_:1}),T("",!0),e(f,{class:"ma-1"},{default:a(()=>[e(U,{to:`/admin/organisations/${u.value.Slug?u.value.Slug:u.value.OrganisationUUID}`},{default:a(()=>[e(x,{variant:"tonal",color:"green",width:"100%"},{default:a(()=>n[7]||(n[7]=[V("Convention Manager")])),_:1})]),_:1},8,["to"])]),_:1})]),_:1})]),_:1}),e(Ve,{modelValue:o.value,"onUpdate:modelValue":n[4]||(n[4]=_=>o.value=_),scrollable:!0,fullscreen:!0,persistent:!0},{default:a(()=>[e(Ue,{onClose:n[1]||(n[1]=_=>o.value=!1),modelValue:u.value,"onUpdate:modelValue":n[2]||(n[2]=_=>u.value=_),onDelete:n[3]||(n[3]=_=>{o.value=!1,D("delete")}),onChange:m},null,8,["modelValue"])]),_:1},8,["modelValue"])]),_:1})}}}),xe=z(we,[["__scopeId","data-v-085ee91f"]]),ta=N({__name:"OrganisationsView",setup(I){const c=te.getInstance(),l=v([]);Ie("Organisations");const u=H(),D=()=>{const d={ID:0,OrganisationUUID:Oe(),Name:"New Organisation",Slug:"",Logo:"",Domain:"",CSS:"",HTML:"",RegTitle:""};c.saveOrganisation(d).then(m=>{m&&l.value.push(m)})},b=d=>{l.value.splice(d,1)};return(()=>{c.getOrganisations().then(d=>{l.value=d})})(),(d,m)=>(C(),w(B,null,{default:a(()=>[e(g,null,{default:a(()=>[(C(!0),M(F,null,le(l.value,(r,n)=>(C(),M(F,{key:r.ID},[p(De)(p(u),r)?(C(),w(f,{key:0,cols:"12",sm:"6",md:"4",lg:"3",class:"d-flex flex-column"},{default:a(()=>[e(xe,{modelValue:l.value[n],"onUpdate:modelValue":U=>l.value[n]=U,class:"elevation-5 flex-1-0 d-flex flex-column",onDelete:U=>b(n)},null,8,["modelValue","onUpdate:modelValue","onDelete"])]),_:2},1024)):T("",!0)],64))),128))]),_:1}),e(g,null,{default:a(()=>[p(ce)(p(u))?(C(),w(f,{key:0,class:"text-right"},{default:a(()=>[e(x,{color:"primary",onClick:D},{default:a(()=>m[0]||(m[0]=[V("New")])),_:1})]),_:1})):T("",!0)]),_:1})]),_:1}))}});export{ta as default};
