import{i as S,r as v,O as Q,L as $,j as X,D as y,l as w,q as a,a1 as U,y as Y,F as r,A as k,G as f,x as C,v as o,H as z,h as l,z as ee,n as s}from"./index-C9q1-qe9.js";import{s as I}from"./index-zHJ-1AxG.js";import{S as O}from"./setupLogin-DjFUg5Pj.js";import{E as i}from"./emailFormVariant-DbFKH7n9.js";import{V as ae}from"./VForm-G8kUFiRc.js";import{V as b}from"./VGrid-CEhoXd7I.js";import{a as V,V as L}from"./VRow-BJNExS0J.js";import{V as G}from"./VTextField-D8yRfWpl.js";import{V as M}from"./VContainer-DBVhkKp0.js";import{_ as W}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{G as te}from"./userData-DZ-0zh3L.js";import{V as le,a as re,c as se,e as oe}from"./VCard-S_uO9ZzV.js";import"./form-WQPlH-kb.js";import"./forwardRefs-CjeG22u4.js";import"./createSimpleFunctional-LOBBqZx8.js";const ne={key:0,class:"ma-auto text-left"},ue={key:1,class:"ma-auto text-left"},ie={key:2,class:"ma-auto text-left"},de={class:"text-red-darken-1 font-weight-bold"},me={class:"text-center mt-4"},ve={class:"pt-4 text-center"},fe=S({__name:"EmailLoginForm",props:{variant:{default:()=>i.COMBINED}},setup(T){const A=$(),D=Q(),c=v(!0),E=v(!1),h=v(!1),N=v(!1),n=v(""),u=v(""),_=v(!1),g=v({required:t=>!!t||"Required.",min:t=>t.length>=8||"Min 8 characters",email:t=>!!t.match(/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/)||"Valid email address required"}),d=v(""),m=v(!1),F=new URL(location.href).searchParams.get("token")||"";F!==""&&(c.value=!1,N.value=!0,D.validateAccount(F,T.variant).then(({created:t,tokens:e,user:R})=>{try{O(e,R,A,t)}catch(p){console.error(p)}}).catch(t=>{console.error(t),d.value=t.ErrorMessage}));const q=X(),B=()=>(d.value="",!(g.value.required(n.value)!==!0||g.value.email(n.value)!==!0||g.value.required(u.value)!==!0||g.value.min(u.value)!==!0)),j=t=>{if(t.preventDefault(),!B())return;const R=new URL(location.href).searchParams.get("state");m.value=!0,D.oAuthLogin("internal",n.value,u.value,R||"").then(({created:p,tokens:J,user:K})=>{O(J,K,A,p)}).catch(()=>{d.value="Login failed, check credentials, try another login method or create account",m.value=!1})},x=t=>{t.preventDefault(),B()&&(m.value=!0,D.registerAccount(n.value,u.value).then(e=>{c.value=!1,e&&(h.value=!0)}).catch(()=>{d.value="Unable to register, address may be in use",m.value=!1}))},Z=()=>{D.requestLoginLink(n.value).then(t=>{c.value=!1,t&&(E.value=!0)}).catch(()=>{d.value="A problem was encountered, please try again",m.value=!1})},H=()=>{A.back()};return(t,e)=>{const R=ee("router-link");return s(),y("div",null,[c.value?(s(),w(ae,{key:0,onSubmit:e[3]||(e[3]=Y(()=>{},["stop"])),class:U(`ma-auto vForm pa-3 rounded-lg theme-${r(q).global.name.value}`),disabled:m.value},{default:a(()=>[l(L,null,{default:a(()=>[l(V,null,{default:a(()=>[l(G,{margin:"normal",required:"",id:"email",label:"Email Address",name:"email",autoComplete:"email",autoFocus:"",variant:"outlined",modelValue:n.value,"onUpdate:modelValue":e[0]||(e[0]=p=>n.value=p),rules:[g.value.required,g.value.email],clearable:!0},null,8,["modelValue","rules"])]),_:1})]),_:1}),l(L,null,{default:a(()=>[l(V,null,{default:a(()=>[l(G,{margin:"normal",required:"",name:"password",label:"Password",type:_.value?"text":"password",id:"password",autoComplete:"current-password",variant:"outlined",modelValue:u.value,"onUpdate:modelValue":e[1]||(e[1]=p=>u.value=p),"append-icon":_.value?"mdi:mdi-eye-off":"mdi:mdi-eye","onClick:append":e[2]||(e[2]=p=>_.value=!_.value),counter:"",hint:"At least 8 characters",rules:[g.value.required,g.value.min],clearable:!0},null,8,["type","modelValue","append-icon","rules"])]),_:1})]),_:1}),d.value?(s(),w(L,{key:0},{default:a(()=>[l(V,{class:"text-red-darken-1 font-weight-bold"},{default:a(()=>[o(C(d.value),1)]),_:1})]),_:1})):k("",!0),l(L,{justify:"space-between"},{default:a(()=>[t.variant===r(i).COMBINED||t.variant===r(i).REGISTER?(s(),w(V,{key:0,cols:"12",sm:"7",order:"2","order-sm":"1"},{default:a(()=>[l(b,{onClick:x,color:"orange-darken-2",disabled:m.value},{default:a(()=>e[5]||(e[5]=[o(" Create Account ")])),_:1},8,["disabled"])]),_:1})):k("",!0),t.variant===r(i).COMBINED||t.variant===r(i).LOGIN?(s(),w(V,{key:1,cols:"12",sm:"5",order:"1","order-sm":"2"},{default:a(()=>[l(b,{onClick:j,color:"success",disabled:m.value,type:"submit"},{default:a(()=>e[6]||(e[6]=[o(" Sign In ")])),_:1},8,["disabled"])]),_:1})):k("",!0),t.variant===r(i).ADD_CREDENTIAL?(s(),w(V,{key:2,cols:"12",sm:"6",class:"flex-grow-0"},{default:a(()=>[l(b,{onClick:x,color:"orange-darken-2",disabled:m.value},{default:a(()=>e[7]||(e[7]=[o(" Add Email ")])),_:1},8,["disabled"])]),_:1})):k("",!0)]),_:1}),t.variant===r(i).COMBINED||t.variant===r(i).LOGIN?(s(),w(M,{key:1},{default:a(()=>[l(L,null,{default:a(()=>[l(V,null,{default:a(()=>[l(b,{variant:"text",onClick:Z},{default:a(()=>[o(C(r(I).buttonForgottenPassword),1)]),_:1})]),_:1})]),_:1})]),_:1})):k("",!0),t.variant===r(i).COMBINED||t.variant===r(i).LOGIN?(s(),w(M,{key:2},{default:a(()=>[l(L,null,{default:a(()=>[l(V,null,{default:a(()=>[l(b,{variant:"flat",color:"primary",onClick:H},{default:a(()=>[o(C(r(I).buttonReturnToLogin),1)]),_:1})]),_:1})]),_:1})]),_:1})):k("",!0)]),_:1},8,["class","disabled"])):(s(),y("div",{key:1,class:U(`ma-auto vForm pa-3 rounded-lg theme-${r(q).global.name.value}`)},[E.value?(s(),y("p",ne,C(r(I).messageResetEmail),1)):h.value?(s(),y("p",ue,C(r(I).messageVerifyNewAccountEmail),1)):N.value?(s(),y("p",ie,[o(C(r(I).messageVerifiedNewAccountMessage)+" ",1),d.value?(s(),y(z,{key:0},[e[11]||(e[11]=f("br",null,null,-1)),e[12]||(e[12]=f("br",null,null,-1)),f("span",de,[e[8]||(e[8]=o(" An error occurred creating or recovering account:")),e[9]||(e[9]=f("br",null,null,-1)),o(" "+C(d.value),1)]),e[13]||(e[13]=f("br",null,null,-1)),e[14]||(e[14]=f("br",null,null,-1)),e[15]||(e[15]=f("span",{class:"text-red-darken-4"}," Please contact registration if you require further assistance. ",-1)),f("div",me,[l(R,{to:"/"},{default:a(()=>[l(b,{color:"red"},{default:a(()=>e[10]||(e[10]=[o("Close")])),_:1})]),_:1})])],64)):k("",!0)])):k("",!0),f("p",ve,[l(b,{color:"primary",onClick:e[4]||(e[4]=p=>{c.value=!0,m.value=!1,E.value=!1,h.value=!1,N.value=!1,d.value=""})},{default:a(()=>e[16]||(e[16]=[o(" Go Back ")])),_:1})])],2))])}}}),P=W(fe,[["__scopeId","data-v-0cc5a52d"]]),pe=S({__name:"LoginWithEmailView",props:{variant:{default:()=>i.COMBINED}},emits:["pageTitle"],setup(T,{emit:A}){A("pageTitle","Email Login");const c=$(),E=te(),N=new URL(location.href).searchParams.get("token")||"";return E&&T.variant!=="ADD_CREDENTIAL"&&!N&&(Date.now()-new Date(E.CreatedAt||"").getTime()>2e4?c.push("/"):c.push("/profile")),(n,u)=>(s(),y("div",null,[n.variant=="ADD_CREDENTIAL"?(s(),w(M,{key:0,style:{"max-width":"550px"}},{default:a(()=>[l(oe,null,{default:a(()=>[l(le,{class:"text-center"},{default:a(()=>[l(re,null,{default:a(()=>u[0]||(u[0]=[o("Add an E-Mail Address")])),_:1})]),_:1}),l(se,null,{default:a(()=>[l(P,{variant:n.variant},null,8,["variant"])]),_:1})]),_:1})]),_:1})):(s(),y(z,{key:1},[u[1]||(u[1]=f("h2",null,"Email",-1)),l(P,{variant:n.variant},null,8,["variant"])],64))]))}}),_e=W(pe,[["__scopeId","data-v-f99ccb02"]]);export{_e as default};
