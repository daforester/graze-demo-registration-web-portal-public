import{P as u}from"./permission-Ba-8wP-4.js";import{O as l}from"./index-BgD2WjuP.js";var i=(r=>(r.TARGET_TYPE_SYSTEM="SYSTEM",r.TARGET_TYPE_ORGANISATION="ORGANISATION",r.TARGET_TYPE_CONVENTION="CONVENTION",r))(i||{});const C=[{title:"Convention",value:"CONVENTION"},{title:"Organisation",value:"ORGANISATION"},{title:"System",value:"SYSTEM"}],_=1e3*60,m=new Map;function p(){const r=l(),a=async n=>{let e=m.get(n);if(!e||e.timestamp<Date.now()-_){const{Conventions:c,Organisations:t}=await r.getPermissionAccessList(n);e={conventions:c,organisations:t,timestamp:Date.now()},m.set(n,e)}const s=e.conventions,o=e.organisations;return{Conventions:s,Organisations:o}};return{getConventionsWithPermission:async n=>{const{Conventions:e}=await a(n);return e},getOrganisationsWithPermission:async n=>{const{Organisations:e}=await a(n);return e}}}const A=1e3*30,T={templates:[],timestamp:0};function S(){const r=l(),{getConventionsWithPermission:a}=p();return{getEmailTemplateList:async(E,n,e)=>{let s=T.templates;T.timestamp<Date.now()-A&&(s=await r.getEmailTemplates(),T.templates=s,T.timestamp=Date.now());const o=await a(u.PERMISSION_TYPE_EDIT_CONVENTION);return(()=>{switch(E){case i.TARGET_TYPE_SYSTEM:return s.filter(t=>t.OwnerType===i.TARGET_TYPE_SYSTEM);case i.TARGET_TYPE_ORGANISATION:return n?s.filter(t=>t.OwnerType===i.TARGET_TYPE_ORGANISATION&&t.OwnerUUID===n):s.filter(t=>t.OwnerType===i.TARGET_TYPE_ORGANISATION);case i.TARGET_TYPE_CONVENTION:return e?s.filter(t=>t.OwnerType===i.TARGET_TYPE_CONVENTION&&t.OwnerUUID===e):n?s.filter(t=>t.OwnerType===i.TARGET_TYPE_CONVENTION&&!!o.find(O=>O.OrganisationUUID===n)):s.filter(t=>t.OwnerType===i.TARGET_TYPE_CONVENTION)}return[]})().sort((t,O)=>t.Title.localeCompare(O.Title))}}}export{i as T,C as a,S as u};
