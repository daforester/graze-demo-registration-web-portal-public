import{_ as ee,T as B,u as le,a as ae}from"./EmailEditor.vue_vue_type_script_setup_true_lang-qrMBgGDF.js";import{i as W,M as w,D as A,n as p,L as te,r as i,C as se,w as oe,A as U,h as a,H as J,l as g,q as t,G as I,v as n,F as ue,N as ie,U as ne,k as de}from"./index-D9OULmPr.js";import{_ as re}from"./ModelDialog.vue_vue_type_script_setup_true_lang-sZ1bo0Et.js";import{_ as me}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{b as Y}from"./forwardRefs-D7N66QHK.js";import{V as H,a as d}from"./VRow-kbilCu_7.js";import{V as ve}from"./VSelect-CO8Paw2e.js";import{V as f,o as fe}from"./VGrid-DLCulbLM.js";import{V as pe,a as Te}from"./VAlert-DzGrWHRe.js";import{V as z}from"./VList-DFfLrHCc.js";import{V as Ve}from"./VOverlay-BKIQLAat.js";import{e as Ee,V as Ue,a as Ce,c as ce}from"./VCard-BQnbq9qP.js";import{V as ge}from"./VSpacer-DiCl2m51.js";import{V as F}from"./VTextField-Bc4CGgtW.js";import{V as Ie}from"./SaveButton.vue_vue_type_script_setup_true_lang-BKd50KGB.js";var we=(u=>(u.CHECK_IN_STATUS_PENDING="CHECK_IN_STATUS_PENDING",u.CHECK_IN_STATUS_COMPLETED="CHECK_IN_STATUS_COMPLETED",u.CHECK_IN_STATUS_REJECTED="CHECK_IN_STATUS_REJECTED",u.CHECK_IN_STATUS_REVOKED="CHECK_IN_STATUS_REVOKED",u))(we||{});const Ne=[{title:"Pending",value:"CHECK_IN_STATUS_PENDING"},{title:"Completed",value:"CHECK_IN_STATUS_COMPLETED"},{title:"Rejected",value:"CHECK_IN_STATUS_REJECTED"},{title:"Revoked",value:"CHECK_IN_STATUS_REVOKED"}],qe=u=>{var r;return((r=Ne.find(c=>c.value===u))==null?void 0:r.title)||""},Se=["innerHTML"],be=W({__name:"EmailPreviewWindow",props:{modelValue:{required:!0},modelModifiers:{}},emits:["update:modelValue"],setup(u){const r=w(u,"modelValue");return(c,M)=>(p(),A("div",{innerHTML:r.value,class:"reset-styles"},null,8,Se))}}),De=me(be,[["__scopeId","data-v-a08129c7"]]),_e={class:"d-flex align-center justify-center",style:{width:"calc(100vw - 25px)",height:"100vh"}},Be=W({__name:"EmailControl",props:te({modelType:{default:"user"},custom:{type:Boolean,default:!1}},{modelValue:{default:[]},modelModifiers:{},details:{required:!1},detailsModifiers:{},convention:{required:!1,default:void 0},conventionModifiers:{},organisation:{required:!1,default:void 0},organisationModifiers:{}}),emits:["update:modelValue","update:details","update:convention","update:organisation"],async setup(u){let r,c;const M=ie(),{getEmailTemplateList:Q}=ae(),O=i([]),s=i(),N=w(u,"modelValue"),x=w(u,"details"),T=w(u,"convention");T.value||(T.value=([r,c]=se(()=>le()),r=await r,c(),r));const R=w(u,"organisation"),V=i(0),E=i([]),L=i(!1),S=i(!1),K=i(0),b=i(0),m=i([]),C=i(!1),D=i(""),_=i(""),y=i(""),k=i(""),P=i(!1),$=()=>{var o,e;Q(B.TARGET_TYPE_CONVENTION,((o=R.value)==null?void 0:o.OrganisationUUID)||null,((e=T.value)==null?void 0:e.ConventionUUID)||null).then(l=>{O.value=l})};oe(T,()=>{$()}),$();const j=(o,e=!1)=>{var v;const l={};return u.modelType=="registration"?l.RegistrationUUID=o:u.modelType=="submission"?l.SubmissionUUID=o:l.UserUUID=o,T.value&&(l.ConventionUUID=T.value.ConventionUUID),R.value&&(l.OrganisationUUID=R.value.OrganisationUUID),s.value&&(s.value.IsDefault?l.TemplateName=s.value.Name:((v=s.value)==null?void 0:v.EmailTemplateUUID)!==ne?l.TemplateUUID=s.value.EmailTemplateUUID:l.Template=s.value),e&&(l.Template=de(s.value),l.TemplateUUID=void 0,l.TemplateName=void 0,l.Template&&(l.Template.HTML=y.value,l.Template.Subject=k.value,l.Template.From=D.value,l.Template.FromName=_.value)),l},G=()=>{E.value=[],N.value.forEach(o=>{const e=j(o,C.value);M.previewEmailTemplate(e).then(l=>{E.value.push(l)})}),V.value=0,L.value=!0};function X(o){return new Promise(e=>setTimeout(e,o))}const q=async()=>{S.value=!0,K.value=0,b.value=0,m.value=[];for(const o of N.value){const e=j(o,C.value);try{await M.sendEmailTemplate(e)}catch{if(e.RegistrationUUID&&x.value&&x.value.length>0){const v=x.value.find(h=>h.RegistrationUUID==e.RegistrationUUID);v?m.value.push(`Failed to send to: #${v.Reference} - ${v.Name}`):m.value.push(`Failed to send to: UUID ${e.RegistrationUUID}`)}else m.value.push(`Failed to send to: UUID ${e.RegistrationUUID}`)}await X(50),K.value+=1,b.value=K.value/N.value.length*100}S.value=!1,m.value.length===0&&(P.value=!0)},Z=async()=>{var o,e,l,v;y.value=((o=s.value)==null?void 0:o.HTML)||"",D.value=((e=s.value)==null?void 0:e.From)||"",_.value=((l=s.value)==null?void 0:l.FromName)||"",k.value=((v=s.value)==null?void 0:v.Subject)||"",C.value=!0};return(o,e)=>(p(),A("div",null,[N.value.length>0?(p(),A(J,{key:0},[a(H,null,{default:t(()=>[a(d,null,{default:t(()=>e[15]||(e[15]=[I("h2",null,"E-Mail",-1),I("p",null," Select an e-mail template to send bulk e-mails to selected registrations. You may preview what is sent before queuing it. ",-1)])),_:1})]),_:1}),C.value?U("",!0):(p(),g(H,{key:0},{default:t(()=>[a(d,{cols:"12",md:"6"},{default:t(()=>[a(ve,{modelValue:s.value,"onUpdate:modelValue":e[0]||(e[0]=l=>s.value=l),items:O.value,"item-value":l=>l,"item-title":"Title","hide-details":"",clearable:""},null,8,["modelValue","items","item-value"])]),_:1}),o.custom?(p(),g(d,{key:0,cols:"4",md:"2"},{default:t(()=>[a(f,{color:"warning",disabled:!s.value,onClick:Z,class:"w-100"},{default:t(()=>e[16]||(e[16]=[n(" Customise ")])),_:1},8,["disabled"])]),_:1})):U("",!0),a(d,{cols:"4",md:"2"},{default:t(()=>[a(f,{color:"primary",disabled:!s.value,onClick:G,class:"w-100"},{default:t(()=>e[17]||(e[17]=[n(" Preview ")])),_:1},8,["disabled"])]),_:1}),a(d,{cols:"4",md:"2",class:"text-right text-sm-left"},{default:t(()=>[a(f,{color:"success",disabled:!s.value,onClick:q,class:"w-100"},{default:t(()=>e[18]||(e[18]=[n(" Send ")])),_:1},8,["disabled"])]),_:1})]),_:1})),m.value.length?(p(),g(pe,{key:1,color:"error",class:"mt-4"},{default:t(()=>[a(Te,null,{default:t(()=>e[19]||(e[19]=[n("Errors Encountered")])),_:1}),a(z,{items:m.value,class:"mt-4 rounded"},null,8,["items"])]),_:1})):U("",!0),a(Ve,{modelValue:S.value,"onUpdate:modelValue":e[2]||(e[2]=l=>S.value=l),"scroll-strategy":"block","location-strategy":"static","close-on-content-click":!1},{default:t(()=>[I("div",_e,[e[22]||(e[22]=n(" > ")),a(Ee,{class:"ma-0",bordered:""},{default:t(()=>[a(Ue,null,{default:t(()=>[a(Ce,{class:"text-center"},{default:t(()=>e[20]||(e[20]=[I("small",null,"Sending Emails",-1)])),_:1})]),_:1}),a(ce,{class:"text-center"},{default:t(()=>[a(fe,{modelValue:b.value,"onUpdate:modelValue":e[1]||(e[1]=l=>b.value=l),color:"error",size:"60",width:"8"},null,8,["modelValue"]),e[21]||(e[21]=I("p",{class:"my-4"}," Navigating away will prevent emails from sending. ",-1)),m.value.length?(p(),g(z,{key:0,items:m.value},null,8,["items"])):U("",!0)]),_:1})]),_:1})])]),_:1},8,["modelValue"]),a(re,{modelValue:L.value,"onUpdate:modelValue":e[6]||(e[6]=l=>L.value=l),fullscreen:!1,"hide-details":!0,title:"Email Preview",scrollable:!0},{actions:t(()=>[a(Y,null,{default:t(()=>[a(f,{color:"primary",disabled:V.value==0,onClick:e[3]||(e[3]=l=>V.value-=1)},{default:t(()=>e[23]||(e[23]=[n(" Previous ")])),_:1},8,["disabled"])]),_:1}),a(ge),a(Y,null,{default:t(()=>[a(f,{color:"primary",disabled:V.value==E.value.length-1,onClick:e[4]||(e[4]=l=>V.value+=1)},{default:t(()=>e[24]||(e[24]=[n(" Next ")])),_:1},8,["disabled"])]),_:1})]),default:t(()=>[E.value.length>0&&E.value[V.value]?(p(),g(De,{key:0,modelValue:E.value[V.value].HTML,"onUpdate:modelValue":e[5]||(e[5]=l=>E.value[V.value].HTML=l)},null,8,["modelValue"])):U("",!0)]),_:1},8,["modelValue"])],64)):U("",!0),C.value?(p(),A(J,{key:1},[a(H,null,{default:t(()=>[a(d,{cols:"12",lg:"4"},{default:t(()=>[a(F,{modelValue:k.value,"onUpdate:modelValue":e[7]||(e[7]=l=>k.value=l),label:"Custom Subject",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1}),a(d,{cols:"12",md:"6",lg:"4"},{default:t(()=>[a(F,{modelValue:_.value,"onUpdate:modelValue":e[8]||(e[8]=l=>_.value=l),label:"Custom From Name",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1}),a(d,{cols:"12",md:"6",lg:"4"},{default:t(()=>[a(F,{modelValue:D.value,"onUpdate:modelValue":e[9]||(e[9]=l=>D.value=l),label:"Custom From Email",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1})]),_:1}),a(ee,{modelValue:y.value,"onUpdate:modelValue":e[10]||(e[10]=l=>y.value=l),convention:T.value,"onUpdate:convention":e[11]||(e[11]=l=>T.value=l),"owner-type":ue(B).TARGET_TYPE_CONVENTION},null,8,["modelValue","convention","owner-type"]),a(H,{class:"justify-end"},{default:t(()=>[a(d,{cols:"4",sm:"2"},{default:t(()=>[a(f,{color:"warning",disabled:!s.value,onClick:e[12]||(e[12]=l=>C.value=!1),class:"w-100"},{default:t(()=>e[25]||(e[25]=[n(" Cancel ")])),_:1},8,["disabled"])]),_:1}),a(d,{cols:"4",sm:"2"},{default:t(()=>[a(f,{color:"primary",disabled:!s.value,onClick:G,class:"w-100"},{default:t(()=>e[26]||(e[26]=[n(" Preview ")])),_:1},8,["disabled"])]),_:1}),a(d,{cols:"4",sm:"2",class:"text-right text-sm-left"},{default:t(()=>[a(f,{color:"success",disabled:!s.value,onClick:q,class:"w-100"},{default:t(()=>e[27]||(e[27]=[n(" Send ")])),_:1},8,["disabled"])]),_:1})]),_:1})],64)):U("",!0),a(Ie,{modelValue:P.value,"onUpdate:modelValue":e[14]||(e[14]=l=>P.value=l)},{actions:t(()=>[a(f,{variant:"text",onClick:e[13]||(e[13]=l=>P.value=!1)},{default:t(()=>e[28]||(e[28]=[n(" Close ")])),_:1})]),default:t(()=>[e[29]||(e[29]=n(" E-mail Sent "))]),_:1},8,["modelValue"])]))}});export{Ne as C,Be as _,qe as a,we as b};
