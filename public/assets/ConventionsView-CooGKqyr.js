import{F as Y}from"./form-Cqw16b_M.js";import{P as H}from"./permission-Ba-8wP-4.js";import{i as b,L as G,M as q,r as c,z,l as d,n as i,q as t,h as s,A as m,v as V,x as j,F as R,G as J,D as S,N as B,R as K,w as Q,P as W,H as X,U as Z}from"./index-D9RL8iMc.js";import{u as ee}from"./useStoreAPI-Dpwh5axk.js";import{_ as te}from"./DeleteDialog.vue_vue_type_script_setup_true_lang-DiUsEteS.js";import{E as oe}from"./EditConventionDialog-CTRzJHIr.js";import{C as L,G as P}from"./canDo-CuuM40rl.js";import{C as ne}from"./canEditRegistrations-C31P-5yG.js";import{C as ae}from"./canViewOperations-BEwKO3uH.js";import{G as M}from"./userData-BDvpB53y.js";import{u as ie}from"./useAdvancedMode-CNlri2OX.js";import{e as se,a as le,b as re,c as $,V as ue,d as de}from"./VCard-CiTz_xe8.js";import{V as ve}from"./forwardRefs-C9X_xFjg.js";import{V as x}from"./VGrid-C8XE4mRo.js";import{V as A,a as T}from"./VRow-BIaXqEK2.js";import{_ as F}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{C as me}from"./canEditOrganisation-BBxBmHLk.js";import{u as pe}from"./useConventionForms-DZgPynOw.js";import{V as ce}from"./VContainer-D5FQdTO1.js";import{v as fe}from"./v4-CtRu48qb.js";import"./SaveButton.vue_vue_type_script_setup_true_lang-BFs6GeYX.js";import"./VOverlay-BhWjqAY_.js";import"./scopeId-CqP4Vn2q.js";import"./VDialog-1gh4dF60.js";import"./VTextField-SUUUHchL.js";import"./form-xBXW6hX0.js";import"./ModelDialog.vue_vue_type_script_setup_true_lang-BjY5Q85z.js";import"./VToolbar-kDURXZrh.js";import"./VSpacer-D26vVx9e.js";import"./createSimpleFunctional-BFFZpP0r.js";import"./index-CndaLrdX.js";import"./SelectGroups.vue_vue_type_script_setup_true_lang-BKbAc1J3.js";import"./VAutocomplete-Bdu9eGKn.js";import"./VSelect-DOgk7ElF.js";import"./VList-DO_fPyUq.js";import"./VDivider-DjhZl5JL.js";import"./VChip-CoLh0RIz.js";import"./filter-DWW1FKGn.js";import"./VTextarea-B-G_qshS.js";import"./VCheckbox-DmNBn-fU.js";import"./VForm-Bj7d0J7l.js";import"./VFileInput-Cb-dAqRm.js";const Ce=(C=void 0,f=void 0)=>C===void 0?!1:f===void 0?L(C,P.GROUP_TYPE_CONVENTION).EditConvention:L(C,P.GROUP_TYPE_CONVENTION,f.ConventionUUID,f).EditConvention,ge=(C,f)=>C===void 0?!1:L(C,P.GROUP_TYPE_CONVENTION,f.ConventionUUID,f).ViewRegistration,De=["innerHTML"],_e={key:0,class:"text-green"},Ue={key:1,class:"text-red"},Ve={key:0,class:"text-green"},Ie={key:1,class:"text-red"},Ne=b({__name:"ConventionCard",props:G({open:{type:Boolean,default:!1}},{modelValue:{required:!0},modelModifiers:{}}),emits:G(["delete","duplicated"],["update:modelValue"]),setup(C,{emit:f}){const E=B(),I=f,e=q(C,"modelValue"),v=ee(),D=M(),_=c(v.GetConventionLogoURL(e.value.ConventionUUID)),w=c(`
Are you sure you wish to delete this convention? All data relating to it will be
removed including all registrations and payment information. This action can
not be undone. To confirm type "I UNDERSTAND" in the box below.
`),U=ie(),g=c(!1),N=c(!1),O=c(Ce(D,e.value)),h=c(ne(D,e.value)),k=c(ge(D,e.value)),n=c(ae(D,e.value)),a=()=>{N.value=!1,_.value=`${v.GetConventionLogoURL(e.value.ConventionUUID)}?ts=${Date.now()}`},l=r=>{E.deleteConvention(e.value.ConventionUUID).then(o=>{o?r&&(r("Convention Deleted"),I("delete")):r&&r("Failed to Delete Convention"),setTimeout(()=>{g.value=!1},2e3)}).catch(()=>{r&&(r("Failed to Delete Organisation"),g.value=!1)})},p=()=>{E.duplicateConvention(e.value.ConventionUUID).then(r=>{r&&I("duplicated",r)})};return(r,o)=>{const u=z("RouterLink");return i(),d(se,null,{default:t(()=>[s(ue,{class:"flex-1-1 align-content-start"},{default:t(()=>[_.value?(i(),d(ve,{key:0,src:_.value,title:e.value.Name,class:"logo text-center"},null,8,["src","title"])):m("",!0),e.value.Name?(i(),d(le,{key:1},{default:t(()=>[V(j(e.value.Name)+" ",1),O.value&&R(U)?(i(),d(x,{key:0,class:"float-right",icon:"mdi:mdi-content-duplicate",size:"small",title:"Duplicate Convention Structure",variant:"flat",onClick:p})):m("",!0)]),_:1})):m("",!0),e.value.Description?(i(),d(re,{key:2,class:"text-wrap subtitle"},{default:t(()=>[J("div",{innerHTML:e.value.Description},null,8,De)]),_:1})):m("",!0),s($,{class:"px-0 pb-0"},{default:t(()=>[o[4]||(o[4]=V(" Visibility:  ")),e.value.Visible?(i(),S("span",_e,"Visible")):(i(),S("span",Ue,"Hidden"))]),_:1}),s($,{class:"px-0 pb-0"},{default:t(()=>[o[5]||(o[5]=V(" Registration:  ")),r.open?(i(),S("span",Ve,"Open")):(i(),S("span",Ie,"Closed"))]),_:1})]),_:1}),s(de,null,{default:t(()=>[s(A,{"no-gutters":""},{default:t(()=>[m("",!0),O.value?(i(),d(T,{key:1,class:"ma-1"},{default:t(()=>[s(u,{to:`/admin/conventions/${e.value.Slug?e.value.Slug:e.value.ConventionUUID}`},{default:t(()=>[s(x,{variant:"tonal",color:"red",width:"100%"},{default:t(()=>o[7]||(o[7]=[V("Configuration")])),_:1})]),_:1},8,["to"])]),_:1})):m("",!0),k.value||h.value?(i(),d(T,{key:2,class:"ma-1"},{default:t(()=>[s(u,{to:`/admin/conventions/${e.value.Slug?e.value.Slug:e.value.ConventionUUID}/registrations`},{default:t(()=>[s(x,{variant:"tonal",color:"green",width:"100%"},{default:t(()=>o[8]||(o[8]=[V("Registrations")])),_:1})]),_:1},8,["to"])]),_:1})):m("",!0),n.value?(i(),d(T,{key:3,class:"ma-1"},{default:t(()=>[s(u,{to:`/admin/conventions/${e.value.Slug?e.value.Slug:e.value.ConventionUUID}/operations`},{default:t(()=>[s(x,{variant:"tonal",color:"blue",width:"100%"},{default:t(()=>o[9]||(o[9]=[V("Operations")])),_:1})]),_:1},8,["to"])]),_:1})):m("",!0),O.value?(i(),d(T,{key:4,class:"ma-1"},{default:t(()=>[s(u,{to:`/admin/conventions/${e.value.Slug?e.value.Slug:e.value.ConventionUUID}/reports`},{default:t(()=>[s(x,{variant:"tonal",color:"purple",width:"100%"},{default:t(()=>o[10]||(o[10]=[V("Reports")])),_:1})]),_:1},8,["to"])]),_:1})):m("",!0)]),_:1})]),_:1}),N.value?(i(),d(oe,{key:0,modelValue:N.value,"onUpdate:modelValue":o[0]||(o[0]=y=>N.value=y),convention:e.value,"onUpdate:convention":o[1]||(o[1]=y=>e.value=y),onDelete:o[2]||(o[2]=y=>g.value=!0),onSave:a,title:`${e.value.Name} General Settings`},null,8,["modelValue","convention","title"])):m("",!0),g.value?(i(),d(te,{key:1,modelValue:g.value,"onUpdate:modelValue":o[3]||(o[3]=y=>g.value=y),"confirmation-text":"I UNDERSTAND",message:w.value,title:"Delete Convention",subtitle:"A quick way to make enemies",onDelete:l},null,8,["modelValue","message"])):m("",!0)]),_:1})}}}),we=F(Ne,[["__scopeId","data-v-2bedf541"]]),ye=b({__name:"ConventionsView",emits:["pageTitle"],setup(C,{emit:f}){var k;f("pageTitle","Conventions");const I=B(),e=M(),v=c([]),D=c([]),_=K();let w=((k=_.params.organisation)==null?void 0:k.toString())||"";const U=c();Q(_,()=>{var n,a;w!==((n=_.params.organisation)==null?void 0:n.toString())&&(w=((a=_.params.organisation)==null?void 0:a.toString())||"",g())});const g=()=>{w?I.getOrganisation(w).then(n=>{n&&(U.value=n,I.getConventionList(n.OrganisationUUID).then(a=>{a&&(v.value=a.sort((l,p)=>l.ID>p.ID?-1:l.ID<p.ID?1:0),N())}))}).catch(()=>{}):I.getPermissionAccessList(H.PERMISSION_TYPE_NULL).then(n=>{n&&(v.value=n.Conventions.sort((a,l)=>a.ID>l.ID?-1:a.ID<l.ID?1:0),N())})},N=()=>{v.value.forEach(n=>{pe(n.ConventionUUID).then(a=>{a&&(D.value=[...D.value,...a])})})},O=()=>{var n,a;if(U.value){const l={ID:0,ConventionUUID:fe(),OrganisationID:((n=U.value)==null?void 0:n.ID)||0,OrganisationUUID:((a=U.value)==null?void 0:a.OrganisationUUID)||Z,Name:"New Convention",Description:"",DetailLink:"",Logo:"",Slug:"",Accommodation:[],Tickets:[],Extras:[],Interests:[],Visible:!1};I.saveConvention(l).then(p=>{p&&v.value.push(p)})}},h=n=>{v.value.splice(n,1)};return g(),(n,a)=>(i(),d(ce,null,{default:t(()=>[s(A,{class:"justify-center"},{default:t(()=>[(i(!0),S(X,null,W(v.value,(l,p)=>(i(),d(T,{key:l.ID,cols:"12",sm:"11",md:"11",lg:"8",xl:"6",class:"d-flex flex-column"},{default:t(()=>{var r,o;return[s(we,{modelValue:v.value[p],"onUpdate:modelValue":u=>v.value[p]=u,class:"elevation-5 flex-1-0 d-flex flex-column","organisation-slug":((r=l.Organisation)==null?void 0:r.Slug)||((o=l.Organisation)==null?void 0:o.OrganisationUUID)||"",open:!!D.value.find(u=>u.ConventionUUID===l.ConventionUUID&&u.Type===R(Y).FORM_TYPE_REGISTRATION&&u.State&&u.State.New),onDelete:u=>h(p),onDuplicated:u=>v.value.push(u)},null,8,["modelValue","onUpdate:modelValue","organisation-slug","open","onDelete","onDuplicated"])]}),_:2},1024))),128))]),_:1}),s(A,null,{default:t(()=>[U.value&&R(me)(R(e),U.value)?(i(),d(T,{key:0,class:"text-right"},{default:t(()=>[s(x,{color:"primary",onClick:O},{default:t(()=>a[0]||(a[0]=[V("New")])),_:1})]),_:1})):m("",!0)]),_:1})]),_:1}))}}),ct=F(ye,[["__scopeId","data-v-1520c907"]]);export{ct as default};
