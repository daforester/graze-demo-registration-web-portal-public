import{_ as Q,T as G,u as X,a as Z}from"./EmailEditor.vue_vue_type_script_setup_true_lang-EdKtgQdf.js";import{i as j,M as w,D as b,n as v,L as h,r as u,C as ee,w as le,A as U,h as a,H as q,l as g,q as t,G as I,v as n,F as ae,N as te,U as se,k as oe}from"./index-BJXsJXEQ.js";import{_ as ie}from"./ModelDialog.vue_vue_type_script_setup_true_lang-ttqoZ9fM.js";import{_ as ue}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{b as B}from"./forwardRefs-D5MLKHVf.js";import{V as R,a as T}from"./VRow-Bg1cyb2c.js";import{V as ne}from"./VSelect-CvB-Fqww.js";import{V as m,o as re}from"./VGrid-Kwp1vHJk.js";import{V as de,a as me}from"./VAlert-Cp1HmrED.js";import{V as F}from"./VList-C7Fmy5_W.js";import{V as ve}from"./VOverlay-DuUHWuCx.js";import{e as fe,V as pe,a as Te,c as Ee}from"./VCard-Bki48CMZ.js";import{V as Ue}from"./VSpacer-BwG4EAcM.js";import{V as Ce}from"./SaveButton.vue_vue_type_script_setup_true_lang-BESi9yVk.js";var Ve=(o=>(o.CHECK_IN_STATUS_PENDING="CHECK_IN_STATUS_PENDING",o.CHECK_IN_STATUS_COMPLETED="CHECK_IN_STATUS_COMPLETED",o.CHECK_IN_STATUS_REJECTED="CHECK_IN_STATUS_REJECTED",o.CHECK_IN_STATUS_REVOKED="CHECK_IN_STATUS_REVOKED",o))(Ve||{});const ce=[{title:"Pending",value:"CHECK_IN_STATUS_PENDING"},{title:"Completed",value:"CHECK_IN_STATUS_COMPLETED"},{title:"Rejected",value:"CHECK_IN_STATUS_REJECTED"},{title:"Revoked",value:"CHECK_IN_STATUS_REVOKED"}],Oe=o=>{var r;return((r=ce.find(c=>c.value===o))==null?void 0:r.title)||""},ge=["innerHTML"],Ie=j({__name:"EmailPreviewWindow",props:{modelValue:{required:!0},modelModifiers:{}},emits:["update:modelValue"],setup(o){const r=w(o,"modelValue");return(c,k)=>(v(),b("div",{innerHTML:r.value,class:"reset-styles"},null,8,ge))}}),we=ue(Ie,[["__scopeId","data-v-a08129c7"]]),_e={class:"d-flex align-center justify-center",style:{width:"calc(100vw - 25px)",height:"100vh"}},$e=j({__name:"EmailControl",props:h({modelType:{default:"user"},custom:{type:Boolean,default:!1}},{modelValue:{default:[]},modelModifiers:{},details:{required:!1},detailsModifiers:{},convention:{required:!1,default:void 0},conventionModifiers:{},organisation:{required:!1,default:void 0},organisationModifiers:{}}),emits:["update:modelValue","update:details","update:convention","update:organisation"],async setup(o){let r,c;const k=te(),{getEmailTemplateList:J}=Z(),x=u([]),i=u(),_=w(o,"modelValue"),P=w(o,"details"),f=w(o,"convention");f.value||(f.value=([r,c]=ee(()=>X()),r=await r,c(),r));const H=w(o,"organisation"),p=u(0),E=u([]),A=u(!1),D=u(!1),M=u(0),N=u(0),d=u([]),C=u(!1),S=u(""),y=u(!1),L=()=>{var s,e;J(G.TARGET_TYPE_CONVENTION,((s=H.value)==null?void 0:s.OrganisationUUID)||null,((e=f.value)==null?void 0:e.ConventionUUID)||null).then(l=>{x.value=l})};le(f,()=>{L()}),L();const K=(s,e=!1)=>{var V;const l={};return o.modelType=="registration"?l.RegistrationUUID=s:o.modelType=="submission"?l.SubmissionUUID=s:l.UserUUID=s,f.value&&(l.ConventionUUID=f.value.ConventionUUID),H.value&&(l.OrganisationUUID=H.value.OrganisationUUID),i.value&&(i.value.IsDefault?l.TemplateName=i.value.Name:((V=i.value)==null?void 0:V.EmailTemplateUUID)!==se?l.TemplateUUID=i.value.EmailTemplateUUID:l.Template=i.value),e&&(l.Template=oe(i.value),l.TemplateUUID=void 0,l.TemplateName=void 0,l.Template&&(l.Template.HTML=S.value)),l},O=()=>{E.value=[],_.value.forEach(s=>{const e=K(s,C.value);k.previewEmailTemplate(e).then(l=>{E.value.push(l)})}),p.value=0,A.value=!0};function Y(s){return new Promise(e=>setTimeout(e,s))}const $=async()=>{D.value=!0,M.value=0,N.value=0,d.value=[];for(const s of _.value){const e=K(s,C.value);try{await k.sendEmailTemplate(e)}catch{if(e.RegistrationUUID&&P.value&&P.value.length>0){const V=P.value.find(W=>W.RegistrationUUID==e.RegistrationUUID);V?d.value.push(`Failed to send to: #${V.Reference} - ${V.Name}`):d.value.push(`Failed to send to: UUID ${e.RegistrationUUID}`)}else d.value.push(`Failed to send to: UUID ${e.RegistrationUUID}`)}await Y(50),M.value+=1,N.value=M.value/_.value.length*100}D.value=!1,d.value.length===0&&(y.value=!0)},z=async()=>{var s;S.value=((s=i.value)==null?void 0:s.HTML)||"",C.value=!0};return(s,e)=>(v(),b("div",null,[_.value.length>0?(v(),b(q,{key:0},[a(R,null,{default:t(()=>[a(T,null,{default:t(()=>e[12]||(e[12]=[I("h2",null,"E-Mail",-1),I("p",null," Select an e-mail template to send bulk e-mails to selected registrations. You may preview what is sent before queuing it. ",-1)])),_:1})]),_:1}),C.value?U("",!0):(v(),g(R,{key:0},{default:t(()=>[a(T,{cols:"12",md:"6"},{default:t(()=>[a(ne,{modelValue:i.value,"onUpdate:modelValue":e[0]||(e[0]=l=>i.value=l),items:x.value,"item-value":l=>l,"item-title":"Title","hide-details":"",clearable:""},null,8,["modelValue","items","item-value"])]),_:1}),s.custom?(v(),g(T,{key:0,cols:"4",md:"2"},{default:t(()=>[a(m,{color:"warning",disabled:!i.value,onClick:z,class:"w-100"},{default:t(()=>e[13]||(e[13]=[n(" Customise ")])),_:1},8,["disabled"])]),_:1})):U("",!0),a(T,{cols:"4",md:"2"},{default:t(()=>[a(m,{color:"primary",disabled:!i.value,onClick:O,class:"w-100"},{default:t(()=>e[14]||(e[14]=[n(" Preview ")])),_:1},8,["disabled"])]),_:1}),a(T,{cols:"4",md:"2",class:"text-right text-sm-left"},{default:t(()=>[a(m,{color:"success",disabled:!i.value,onClick:$,class:"w-100"},{default:t(()=>e[15]||(e[15]=[n(" Send ")])),_:1},8,["disabled"])]),_:1})]),_:1})),d.value.length?(v(),g(de,{key:1,color:"error",class:"mt-4"},{default:t(()=>[a(me,null,{default:t(()=>e[16]||(e[16]=[n("Errors Encountered")])),_:1}),a(F,{items:d.value,class:"mt-4 rounded"},null,8,["items"])]),_:1})):U("",!0),a(ve,{modelValue:D.value,"onUpdate:modelValue":e[2]||(e[2]=l=>D.value=l),"scroll-strategy":"block","location-strategy":"static","close-on-content-click":!1},{default:t(()=>[I("div",_e,[e[19]||(e[19]=n(" > ")),a(fe,{class:"ma-0",bordered:""},{default:t(()=>[a(pe,null,{default:t(()=>[a(Te,{class:"text-center"},{default:t(()=>e[17]||(e[17]=[I("small",null,"Sending Emails",-1)])),_:1})]),_:1}),a(Ee,{class:"text-center"},{default:t(()=>[a(re,{modelValue:N.value,"onUpdate:modelValue":e[1]||(e[1]=l=>N.value=l),color:"error",size:"60",width:"8"},null,8,["modelValue"]),e[18]||(e[18]=I("p",{class:"my-4"}," Navigating away will prevent emails from sending. ",-1)),d.value.length?(v(),g(F,{key:0,items:d.value},null,8,["items"])):U("",!0)]),_:1})]),_:1})])]),_:1},8,["modelValue"]),a(ie,{modelValue:A.value,"onUpdate:modelValue":e[6]||(e[6]=l=>A.value=l),fullscreen:!1,"hide-details":!0,title:"Email Preview",scrollable:!0},{actions:t(()=>[a(B,null,{default:t(()=>[a(m,{color:"primary",disabled:p.value==0,onClick:e[3]||(e[3]=l=>p.value-=1)},{default:t(()=>e[20]||(e[20]=[n(" Previous ")])),_:1},8,["disabled"])]),_:1}),a(Ue),a(B,null,{default:t(()=>[a(m,{color:"primary",disabled:p.value==E.value.length-1,onClick:e[4]||(e[4]=l=>p.value+=1)},{default:t(()=>e[21]||(e[21]=[n(" Next ")])),_:1},8,["disabled"])]),_:1})]),default:t(()=>[E.value.length>0&&E.value[p.value]?(v(),g(we,{key:0,modelValue:E.value[p.value].HTML,"onUpdate:modelValue":e[5]||(e[5]=l=>E.value[p.value].HTML=l)},null,8,["modelValue"])):U("",!0)]),_:1},8,["modelValue"])],64)):U("",!0),C.value?(v(),b(q,{key:1},[a(Q,{modelValue:S.value,"onUpdate:modelValue":e[7]||(e[7]=l=>S.value=l),convention:f.value,"onUpdate:convention":e[8]||(e[8]=l=>f.value=l),"owner-type":ae(G).TARGET_TYPE_CONVENTION},null,8,["modelValue","convention","owner-type"]),a(R,{class:"justify-end"},{default:t(()=>[a(T,{cols:"4",sm:"2"},{default:t(()=>[a(m,{color:"warning",disabled:!i.value,onClick:e[9]||(e[9]=l=>C.value=!1),class:"w-100"},{default:t(()=>e[22]||(e[22]=[n(" Cancel ")])),_:1},8,["disabled"])]),_:1}),a(T,{cols:"4",sm:"2"},{default:t(()=>[a(m,{color:"primary",disabled:!i.value,onClick:O,class:"w-100"},{default:t(()=>e[23]||(e[23]=[n(" Preview ")])),_:1},8,["disabled"])]),_:1}),a(T,{cols:"4",sm:"2",class:"text-right text-sm-left"},{default:t(()=>[a(m,{color:"success",disabled:!i.value,onClick:$,class:"w-100"},{default:t(()=>e[24]||(e[24]=[n(" Send ")])),_:1},8,["disabled"])]),_:1})]),_:1})],64)):U("",!0),a(Ce,{modelValue:y.value,"onUpdate:modelValue":e[11]||(e[11]=l=>y.value=l)},{actions:t(()=>[a(m,{variant:"text",onClick:e[10]||(e[10]=l=>y.value=!1)},{default:t(()=>e[25]||(e[25]=[n(" Close ")])),_:1})]),default:t(()=>[e[26]||(e[26]=n(" E-mail Sent "))]),_:1},8,["modelValue"])]))}});export{ce as C,$e as _,Oe as a,Ve as b};
