import{u as R}from"./useStoreAPI-zRRGrc1K.js";import{i as x,r as u,$ as B,w as F,l as g,q as s,n as m,D as S,h as n,G as b,v as w,H as _,O as E,R as M}from"./index-SDpjOfEK.js";import{V as O}from"./VApp-C_kS5V2n.js";import{V as T,a as j}from"./VAlert-Q2g8-bvw.js";import{a as N,V as P}from"./VRow-DPWtpV-z.js";import{V as G}from"./VSelect-CRl7qyu_.js";import{V as H}from"./VGrid-BGPmBRnj.js";import"./scopeId-G8KLxvpZ.js";import"./createSimpleFunctional-CSiOTkN6.js";import"./VTextField-BBDZZhSJ.js";import"./forwardRefs-DfTulyk4.js";import"./form-DiO8Onov.js";import"./VList-QopZ7B7L.js";import"./VDivider-BQjLzC2r.js";import"./VOverlay-CZc4vxJ-.js";import"./VChip-DU66b-sQ.js";const ne=x({__name:"CameraView",setup($){const h=E(),y=R(),V=M(),d=u(!1),t=B("videoDisplay"),l=u({facingMode:"environment"}),p=[{label:"Rear Camera",constraints:{facingMode:"environment"}},{label:"Front Camera",constraints:{facingMode:"user"}}],v=u(p),i=u(null),C=async()=>{const a=(await navigator.mediaDevices.enumerateDevices()).filter(({kind:o})=>o==="videoinput");v.value=[...p,...a.map(({deviceId:o,label:c})=>({label:`${c}`,constraints:{deviceId:o}}))]};navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"}}).then(e=>{i.value=e,t.value&&(t.value.srcObject=e,t.value.play(),C())}).catch(e=>{console.error("Error accessing camera: ",e)});const D=()=>{if(!t.value)return;const e=document.createElement("canvas");e.width=t.value.videoWidth,e.height=t.value.videoHeight;const a=e.getContext("2d",{alpha:!1,jpegQuality:.8});a&&"drawImage"in a&&a.drawImage(t.value,0,0);const o=e.toDataURL("image/webp").replace(/^data:image\/(png|jpeg|webp);base64,/,"");I(o)},I=(e,a="capture.webp")=>{const o=atob(e),c=new Array(o.length);for(let r=0;r<o.length;r++)c[r]=o.charCodeAt(r);const A=new Uint8Array(c),U=new Blob([A],{type:"image/webp"}),f=new FormData;f.append("image",U,a),y.SaveFormFile(f).then(r=>{console.log("Success:",r),h.registerCameraTetherSession(V.params.session,r.FileUUID).then(k=>{k.FileUUID&&(console.log("Camera tether session registered"),d.value=!0)})}).catch(r=>{console.error("Error:",r)})};return F(l,()=>{i.value&&i.value.getTracks().forEach(e=>e.stop()),navigator.mediaDevices.getUserMedia({video:{deviceId:{exact:l.value.deviceId}}}).then(e=>{i.value=e,t.value&&(t.value.srcObject=e,t.value.play())}).catch(e=>{console.error("Error accessing camera:",e)})}),(e,a)=>(m(),g(O,null,{default:s(()=>[d.value?(m(),g(T,{key:0,color:"success"},{default:s(()=>[n(j,null,{default:s(()=>a[1]||(a[1]=[w("Photo Received")])),_:1}),a[2]||(a[2]=b("p",null," You may now close this window. ",-1))]),_:1})):(m(),S(_,{key:1},[n(P,null,{default:s(()=>[n(N,null,{default:s(()=>[n(G,{modelValue:l.value,"onUpdate:modelValue":a[0]||(a[0]=o=>l.value=o),items:v.value,"item-title":"label","item-value":"constraints",label:"Select Camera","hide-details":"",clearable:""},null,8,["modelValue","items"])]),_:1})]),_:1}),b("video",{ref_key:"videoDisplay",ref:t},null,512),n(H,{color:"success",class:"rounded-0",onClick:D},{default:s(()=>a[3]||(a[3]=[w("Capture")])),_:1})],64))]),_:1}))}});export{ne as default};
