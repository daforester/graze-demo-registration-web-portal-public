import{p as B,r as v,s as I,c as S,a as ie,w as E,o as ue,b as ce,d as A,u as de,t as L,e as W,f as Q,h as t,m as F,i as Y,j as X,k as q,E as Z,l as _,n as g,q as u,v as ee,x as U,y as me,z as G,A as R,B as ae,C as ve,D as H,F as x,G as ge,H as fe,I as pe,J as he,K as ye,T as Ve,S as _e}from"./index-CxNj4NCr.js";import{G as ke,R as z,a as Se}from"./userData-sbQ6wRDS.js";import{u as Te}from"./useAvatar-BelxVrCG.js";import{C as be}from"./canEditOrganisation-Bu_vfdHZ.js";import{C as D,G as M}from"./canDo-RsDuoi3-.js";import{C as we}from"./canViewOperations-CHH_qGxk.js";import{u as Ce}from"./useAdvancedMode-BB4cNeh7.js";import{u as O,V as Ie,m as Pe,a as Re,b as Le,c as te,d as oe,e as Ne,f as Be,g as Ee,h as Ue,i as xe,j as De,k as Me,l as Ae,n as Oe}from"./VGrid-CYD2DdrP.js";import{u as le,m as se,c as He,a as ze}from"./scopeId-DZxlzGo5.js";import{V as j,m as Ge,a as $e}from"./VToolbar-BQtwcuS4.js";import{u as Fe,V as J,a as T,b as Ye}from"./VList-BQYoHMIB.js";import{V as qe}from"./VSpacer-DddBMYKX.js";import{V as je}from"./VTextField-Bok2vESA.js";import{V as Je,a as ne}from"./VNavigationDrawer-DWuv1WjJ.js";import{V as $,a as Ke}from"./forwardRefs-CvFGg0Gc.js";import{V as We}from"./VDivider-EDQwe-ve.js";import{_ as re}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{s as Qe}from"./index-CndaLrdX.js";import{V as K}from"./VContainer-CD0gYM77.js";import{V as Xe}from"./VApp-Br3s8dsb.js";import"./useStoreAPI-B5zloe5K.js";import"./createSimpleFunctional-OCHRO3I1.js";import"./form-VOSgkAsQ.js";const Ze=(e,i=void 0)=>e===void 0?!1:i===void 0?D(e,M.GROUP_TYPE_CONVENTION).ManageUsers:D(e,M.GROUP_TYPE_CONVENTION,i.ConventionUUID,i).ManageUsers,ea=(e,i=void 0)=>{let o;return e===void 0?!1:(i===void 0?o=D(e,M.GROUP_TYPE_CONVENTION):o=D(e,M.GROUP_TYPE_CONVENTION,i.ConventionUUID,i),o.EditConvention||o.ManageViews||o.ViewRegistration||o.EditRegistration)},aa=B({scrollTarget:{type:String},scrollThreshold:{type:[String,Number],default:300}},"scroll");function ta(e){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{canScroll:o}=i;let c=0,l=0;const a=v(null),r=I(0),d=I(0),m=I(0),p=I(!1),n=I(!1),y=S(()=>Number(e.scrollThreshold)),w=S(()=>ie((y.value-r.value)/y.value||0)),h=()=>{const f=a.value;if(!f||o&&!o.value)return;c=r.value,r.value="window"in f?f.pageYOffset:f.scrollTop;const k=f instanceof Window?document.documentElement.scrollHeight:f.scrollHeight;if(l!==k){l=k;return}n.value=r.value<c,m.value=Math.abs(r.value-y.value)};return E(n,()=>{d.value=d.value||r.value}),E(p,()=>{d.value=0}),ue(()=>{E(()=>e.scrollTarget,f=>{var C;const k=f?document.querySelector(f):window;k&&k!==a.value&&((C=a.value)==null||C.removeEventListener("scroll",h),a.value=k,a.value.addEventListener("scroll",h,{passive:!0}))},{immediate:!0})}),ce(()=>{var f;(f=a.value)==null||f.removeEventListener("scroll",h)}),o&&E(o,h,{immediate:!0}),{scrollThreshold:y,currentScroll:r,currentThreshold:m,isScrollActive:p,scrollRatio:w,isScrollingUp:n,savedScroll:d}}const oa=B({scrollBehavior:String,modelValue:{type:Boolean,default:!0},location:{type:String,default:"top",validator:e=>["top","bottom"].includes(e)},...Ge(),...se(),...aa(),height:{type:[Number,String],default:64}},"VAppBar"),la=A()({name:"VAppBar",props:oa(),emits:{"update:modelValue":e=>!0},setup(e,i){let{slots:o}=i;const c=v(),l=de(e,"modelValue"),a=S(()=>{var V;const s=new Set(((V=e.scrollBehavior)==null?void 0:V.split(" "))??[]);return{hide:s.has("hide"),fullyHide:s.has("fully-hide"),inverted:s.has("inverted"),collapse:s.has("collapse"),elevate:s.has("elevate"),fadeImage:s.has("fade-image")}}),r=S(()=>{const s=a.value;return s.hide||s.fullyHide||s.inverted||s.collapse||s.elevate||s.fadeImage||!l.value}),{currentScroll:d,scrollThreshold:m,isScrollingUp:p,scrollRatio:n}=ta(e,{canScroll:r}),y=L(()=>a.value.hide||a.value.fullyHide),w=S(()=>e.collapse||a.value.collapse&&(a.value.inverted?n.value>0:n.value===0)),h=S(()=>e.flat||a.value.fullyHide&&!l.value||a.value.elevate&&(a.value.inverted?d.value>0:d.value===0)),f=S(()=>a.value.fadeImage?a.value.inverted?1-n.value:n.value:void 0),k=S(()=>{var N,b;if(a.value.hide&&a.value.inverted)return 0;const s=((N=c.value)==null?void 0:N.contentHeight)??0,V=((b=c.value)==null?void 0:b.extensionHeight)??0;return y.value?d.value<m.value||a.value.fullyHide?s+V:s:s+V});W(()=>!!e.scrollBehavior,()=>{Q(()=>{y.value?a.value.inverted?l.value=d.value>m.value:l.value=p.value||d.value<m.value:l.value=!0})});const{ssrBootStyles:C}=Fe(),{layoutItemStyles:P}=le({id:e.name,order:S(()=>parseInt(e.order,10)),position:L(()=>e.location),layoutSize:k,elementSize:I(void 0),active:l,absolute:L(()=>e.absolute)});return O(()=>{const s=j.filterProps(e);return t(j,F({ref:c,class:["v-app-bar",{"v-app-bar--bottom":e.location==="bottom"},e.class],style:[{...P.value,"--v-toolbar-image-opacity":f.value,height:void 0,...C.value},e.style]},s,{collapse:w.value,flat:h.value}),o)}),{}}}),sa=B({...Pe({icon:"$menu",variant:"text"})},"VAppBarNavIcon"),na=A()({name:"VAppBarNavIcon",props:sa(),setup(e,i){let{slots:o}=i;return O(()=>t(Ie,F(e,{class:["v-app-bar-nav-icon"]}),o)),{}}}),ra=B({...te(),...Le(),...ze()},"VLayout"),ia=A()({name:"VLayout",props:ra(),setup(e,i){let{slots:o}=i;const{layoutClasses:c,layoutStyles:l,getLayoutItem:a,items:r,layoutRef:d}=He(e),{dimensionStyles:m}=Re(e);return O(()=>{var p;return t("div",{ref:d,class:[c.value,e.class],style:[m.value,l.value,e.style]},[(p=o.default)==null?void 0:p.call(o)])}),{getLayoutItem:a,items:r}}}),ua=Y({__name:"DashboardLayout",props:{user:{}},setup(e){const i=Te(),o=X(),c=v(!1),l=v("Default Title"),a=v(""),r=v(q(e.user)),d=v(i(r.value.UserUUID)),m=Z.getInstance();Ce(),m.on("user.profile.saved",P=>{r.value=q(P)});const p=()=>window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light",n=v(localStorage.getItem("theme")||p());o.global.name.value=n.value;const y=()=>{n.value=="light"?n.value="dark":n.value="light",o.global.name.value=n.value,localStorage.setItem("theme",n.value)},w=async P=>{l.value=P;const s=await ae();document.title=`${s!=null&&s.Name?`${s.Name} - `:""} ${l.value}`},h=v(ea(e.user)),f=v(we(e.user)),k=v(be(e.user)),C=v(Ze(e.user));return(P,s)=>{const V=G("RouterLink"),N=G("RouterView");return g(),_(ia,{class:"h-100"},{default:u(()=>[t(la,{color:"blue-darken-3"},{default:u(()=>[t($e,null,{default:u(()=>[ee(U(l.value),1)]),_:1}),t(qe),t(je,{modelValue:a.value,"onUpdate:modelValue":s[0]||(s[0]=b=>a.value=b),"prepend-inner-icon":"mdi:mdi-magnify",label:"Search",variant:"underlined","hide-details":"",clearable:!0,class:"d-none"},null,8,["modelValue"]),t(na,{variant:"text",onClick:s[1]||(s[1]=me(b=>c.value=!c.value,["stop"]))})]),_:1}),t(Je,{modelValue:c.value,"onUpdate:modelValue":s[2]||(s[2]=b=>c.value=b),location:"right",temporary:!0},{default:u(()=>[t(J,null,{default:u(()=>[t(V,{to:{name:"Profile"}},{default:u(()=>[t(T,{title:r.value.DisplayName},{prepend:u(()=>[d.value?(g(),_($,{key:0,src:d.value,class:"rounded-circle mr-2",height:"32",width:"32"},null,8,["src"])):(g(),_(oe,{key:1,icon:"mdi:mdi-account-circle",size:"x-large"}))]),_:1},8,["title"])]),_:1})]),_:1}),t(We),t(N,{name:"navigation"},{default:u(()=>[t(J,null,{default:u(()=>[t(V,{to:"/"},{default:u(()=>[t(T,{"prepend-icon":"mdi:mdi-view-dashboard-outline",title:"Home",value:"home"})]),_:1}),h.value||k.value||C.value?(g(),_(Ye,{key:0,value:"Admin"},{activator:u(({props:b})=>[t(T,F(b,{"prepend-icon":"mdi:mdi-security",title:"Admin"}),null,16)]),default:u(()=>[h.value||f.value?(g(),_(V,{key:0,to:"/admin/conventions"},{default:u(()=>[t(T,{"prepend-icon":"mdi:mdi-domain",title:"Conventions",value:"Conventions"})]),_:1})):R("",!0),k.value||h.value?(g(),_(V,{key:1,to:"/admin/email/templates"},{default:u(()=>[t(T,{"prepend-icon":"mdi:mdi-email-edit-outline",title:"Email Templates",value:"Email Templates"})]),_:1})):R("",!0),k.value?(g(),_(V,{key:2,to:"/admin/organisations"},{default:u(()=>[t(T,{"prepend-icon":"mdi:mdi-store",title:"Organisations",value:"Organisations"})]),_:1})):R("",!0),C.value?(g(),_(V,{key:3,to:"/admin/groups"},{default:u(()=>[t(T,{"prepend-icon":"mdi:mdi-key-chain-variant",title:"Permissions",value:"Permissions"})]),_:1})):R("",!0)]),_:1})):R("",!0),t(V,{to:{name:"Profile"}},{default:u(()=>[t(T,{"prepend-icon":"mdi:mdi-account-circle",title:"Manage Account"})]),_:1}),t(T,{"prepend-icon":"mdi:mdi-theme-light-dark",onClick:y,title:`${n.value=="light"?"Dark":"Light"} Mode`},null,8,["title"]),t(V,{to:"/logout"},{default:u(()=>[t(T,{"prepend-icon":"mdi:mdi-logout",title:"Logout",value:"Logout"})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(ne,null,{default:u(()=>[t(N,{onPageTitle:w,"logged-in":!0})]),_:1})]),_:1})}}}),ca=re(ua,[["__scopeId","data-v-142cf0ca"]]),da="/assets/graze-logo-CM-MvGxq.svg",ma={key:2},va={key:3},ga=Y({__name:"LoginLayout",async setup(e){let i,o;const c=X(),l=v();l.value=([i,o]=ve(()=>ae()),i=await i,o(),i),document.title=`${l.value?`${l.value.Name} - `:"Convention"} Registration System`;const a=()=>window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light",r=v(localStorage.getItem("theme")||a());return c.global.name.value=r.value,(d,m)=>{const p=G("RouterView");return g(),H(fe,null,[t(K,{class:"logo-container text-center"},{default:u(()=>{var n;return[l.value&&l.value.Logo?(g(),_($,{key:0,src:l.value.Logo,class:"graze-logo ma-auto"},null,8,["src"])):(g(),_($,{key:1,src:x(da),class:"graze-logo ma-auto"},null,8,["src"])),l.value&&l.value.RegTitle?(g(),H("h1",ma,U(l.value.RegTitle),1)):(g(),H("h1",va,U(((n=l.value)==null?void 0:n.Name)||"Graze")+" Registration System",1))]}),_:1}),t(K,{class:"login-container text-center mb-0 rounded rounded-lg mb-md-10"},{default:u(()=>[t(Ke,null,{default:u(()=>[t(oe,{class:"ma-2 pa-5 bg-indigo rounded-circle",color:"white",icon:"mdi:mdi-lock-outline"})]),_:1}),ge("h2",null,U(x(Qe).headingSignIn),1),t(p,{"logged-in":!1})]),_:1})],64)}}}),fa=re(ga,[["__scopeId","data-v-9ce1b973"]]),pa=B({app:Boolean,color:String,height:{type:[Number,String],default:"auto"},...Oe(),...te(),...Ae(),...se(),...Me(),...De({tag:"footer"}),...ye()},"VFooter"),ha=A()({name:"VFooter",props:pa(),setup(e,i){let{slots:o}=i;const c=v(),{themeClasses:l}=pe(e),{backgroundColorClasses:a,backgroundColorStyles:r}=Ne(()=>e.color),{borderClasses:d}=Be(e),{elevationClasses:m}=Ee(e),{roundedClasses:p}=Ue(e),n=I(32),{resizeRef:y}=xe(h=>{h.length&&(n.value=h[0].target.clientHeight)}),w=S(()=>e.height==="auto"?n.value:parseInt(e.height,10));return W(()=>e.app,()=>{const h=le({id:e.name,order:S(()=>parseInt(e.order,10)),position:L(()=>"bottom"),layoutSize:w,elementSize:S(()=>e.height==="auto"?void 0:w.value),active:L(()=>e.app),absolute:L(()=>e.absolute)});Q(()=>{c.value=h.layoutItemStyles.value})}),O(()=>t(e.tag,{ref:y,class:["v-footer",l.value,a.value,d.value,m.value,p.value,e.class],style:[r.value,e.app?c.value:{height:he(e.height)},e.style]},o)),{}}}),za=Y({__name:"Default",emits:["pageTitle"],setup(e,{emit:i}){let o=ke();const c=Ve.getInstance(),l=c.getTokenByService("GrazeAPI"),a=v(!1),r=v(!1),d=i,m=Z.getInstance();m.on("login",n=>{o=n,a.value=!0}),m.on("logout",()=>{o=void 0,a.value=!1}),m.on("tokenManager.tokenUpdated",()=>{a.value=!0,r.value=!0}),m.on("tokenManager.sessionExpired",()=>{a.value=!1,r.value=!1,z(),location.reload()}),l?o?l.AccessExpires<=Date.now()&&l.RefreshExpires>Date.now()?c.refreshToken(l):l.AccessExpires>Date.now()?(z(),a.value=!1,r.value=!0):(a.value=!0,r.value=!0):Se().then(n=>{o=n,a.value=!0,r.value=!0}).catch(()=>{a.value=!1,r.value=!0}):(z(),a.value=!1,r.value=!0);const p=n=>{d("pageTitle",n)};return(n,y)=>(g(),_(_e,null,{default:u(()=>[t(Xe,{class:"bg-image"},{default:u(()=>[r.value?(g(),_(ne,{key:0},{default:u(()=>[a.value&&x(o)?(g(),_(ca,{key:0,user:x(o),onPageTitle:p},null,8,["user"])):(g(),_(fa,{key:1}))]),_:1})):R("",!0),t(ha,null,{default:u(()=>y[0]||(y[0]=[ee(" Powered by Graze ")])),_:1})]),_:1})]),_:1}))}});export{za as default};
